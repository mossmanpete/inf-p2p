!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/inf-p2p/",n(n.s=19)}([function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t,n){var r=Object.keys,i=Array.isArray,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:t;function o(t,e){return"object"!=typeof e?t:(r(e).forEach(function(n){t[n]=e[n]}),t)}var a=Object.getPrototypeOf,u={}.hasOwnProperty;function h(t,e){return u.call(t,e)}function c(t,e){"function"==typeof e&&(e=e(a(t))),r(e).forEach(function(n){f(t,n,e[n])})}var l=Object.defineProperty;function f(t,e,n,r){l(t,e,o(n&&h(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function d(t){return{from:function(e){return t.prototype=Object.create(e.prototype),f(t.prototype,"constructor",t),{extend:c.bind(null,t.prototype)}}}}var m=Object.getOwnPropertyDescriptor,p=[].slice;function y(t,e,n){return p.call(t,e,n)}function v(t,e){return e(t)}function g(t){if(!t)throw new Error("Assertion Failed")}function x(t){s.setImmediate?n(t):setTimeout(t,0)}function b(t,e){return t.reduce(function(t,n,r){var i=e(n,r);return i&&(t[i[0]]=i[1]),t},{})}function w(t,e,n){try{t.apply(null,n)}catch(t){e&&e(t)}}function _(t,e){if(h(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var s=_(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(-1!==o){var a=t[e.substr(0,o)];return void 0===a?void 0:_(a,e.substr(o+1))}}function M(t,e,n){if(t&&void 0!==e&&!("isFrozen"in Object&&Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){g("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)M(t,e[r],n[r])}else{var s=e.indexOf(".");if(-1!==s){var o=e.substr(0,s),a=e.substr(s+1);if(""===a)void 0===n?delete t[o]:t[o]=n;else{var u=t[o];u||(u=t[o]={}),M(u,a,n)}}else void 0===n?delete t[e]:t[e]=n}}function z(t){var e={};for(var n in t)h(t,n)&&(e[n]=t[n]);return e}var k=[].concat;function A(t){return k.apply([],t)}var S="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(A([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return s[t]}).map(function(t){return s[t]});function E(t){if(!t||"object"!=typeof t)return t;var e;if(i(t)){e=[];for(var n=0,r=t.length;n<r;++n)e.push(E(t[n]))}else if(S.indexOf(t.constructor)>=0)e=t;else for(var s in e=t.constructor?Object.create(t.constructor.prototype):{},t)h(t,s)&&(e[s]=E(t[s]));return e}function T(t,e,n,i){return n=n||{},i=i||"",r(t).forEach(function(r){if(h(e,r)){var s=t[r],o=e[r];"object"==typeof s&&"object"==typeof o&&s&&o&&""+s.constructor==""+o.constructor?T(s,o,n,i+r+"."):s!==o&&(n[i+r]=e[r])}else n[i+r]=void 0}),r(e).forEach(function(r){h(t,r)||(n[i+r]=e[r])}),n}var N="undefined"!=typeof Symbol&&Symbol.iterator,O=N?function(t){var e;return null!=t&&(e=t[N])&&e.apply(t)}:function(){return null},j={};function C(t){var e,n,r,s;if(1===arguments.length){if(i(t))return t.slice();if(this===j&&"string"==typeof t)return[t];if(s=O(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var B="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function U(t,e){B=t,I=e}var I=function(){return!0},P=!new Error("").stack;function D(){if(P)try{throw D.arguments,new Error}catch(t){return t}return new Error}function V(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(I).map(function(t){return"\n"+t}).join("")):""}var F=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],R=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(F),q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function H(t,e){this._e=D(),this.name=t,this.message=e}function G(t,e,n,r){this._e=D(),this.failures=e,this.failedKeys=r,this.successCount=n}function W(t,e){this._e=D(),this.name="BulkError",this.failures=e,this.message=function(t,e){return t+". Errors: "+e.map(function(t){return t.toString()}).filter(function(t,e,n){return n.indexOf(t)===e}).join("\n")}(t,e)}d(H).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+V(this._e,2))}},toString:function(){return this.name+": "+this.message}}),d(G).from(H),d(W).from(H);var K=R.reduce(function(t,e){return t[e]=e+"Error",t},{}),L=H,X=R.reduce(function(t,e){var n=e+"Error";function r(t,r){this._e=D(),this.name=n,t?"string"==typeof t?(this.message=t,this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=q[e]||n,this.inner=null)}return d(r).from(L),t[e]=r,t},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var Y=F.reduce(function(t,e){return t[e+"Error"]=X[e],t},{}),Z=R.reduce(function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=X[e]),t},{});function Q(){}function J(t){return t}function $(t,e){return null==t||t===J?e:function(n){return e(t(n))}}function tt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function et(t,e){return t===Q?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?tt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?tt(i,this.onerror):i),void 0!==s?s:n}}function nt(t,e){return t===Q?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?tt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?tt(r,this.onerror):r)}}function rt(t,e){return t===Q?e:function(n){var r=t.apply(this,arguments);o(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?tt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?tt(s,this.onerror):s),void 0===r?void 0===a?void 0:a:o(r,a)}}function it(t,e){return t===Q?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function st(t,e){return t===Q?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Z.ModifyError=G,Z.DexieError=H,Z.BulkError=W;var ot={},at=100,ut=7,ht=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(e){var t=s.Promise;return t?[t.resolve(),t.prototype,t.resolve()]:[]}}(),ct=ht[0],lt=ht[1],ft=ht[2],dt=lt&&lt.then,mt=ct&&ct.constructor,pt=ht[3],yt=!!ft,vt=!1,gt=ft?function(){ft.then(Vt)}:s.setImmediate?n.bind(null,Vt):s.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){Vt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Vt,0)},xt=function(t,e){Et.push([t,e]),wt&&(gt(),wt=!1)},bt=!0,wt=!0,_t=[],Mt=[],zt=null,kt=J,At={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ue,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{ue(t[0],t[1])}catch(t){}})}},St=At,Et=[],Tt=0,Nt=[];function Ot(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Q,this._lib=!1;var e=this._PSD=St;if(B&&(this._stackHolder=D(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==ot)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Bt(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,n){try{n(function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Ft();n&&"function"==typeof n.then?t(e,function(t,e){n instanceof Ot?n._then(t,e):n.then(t,e)}):(e._state=!0,e._value=n,Ut(e)),r&&Rt()}},Bt.bind(null,e))}catch(t){Bt(e,t)}}(this,t)}var jt={get:function(){var t=St,e=Yt;function n(n,r){var i=this,s=!t.global&&(t!==St||e!==Yt);s&&$t();var o=new Ot(function(e,o){It(i,new Ct(se(n,t,s),se(r,t,s),e,o,t))});return B&&Dt(o,this),o}return n.prototype=ot,n},set:function(t){f(this,"then",t&&t.prototype===ot?jt:{get:function(){return t},set:jt.set})}};function Ct(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function Bt(t,e){if(Mt.push(e),null===t._state){var n=t._lib&&Ft();e=kt(e),t._state=!1,t._value=e,B&&null!==e&&"object"==typeof e&&!e._promise&&w(function(){var n=function t(e,n){var r;return m(e,n)||(r=a(e))&&t(r,n)}(e,"stack");e._promise=t,f(e,"stack",{get:function(){return vt?n&&(n.get?n.get.apply(e):n.value):t.stack}})}),function(t){_t.some(function(e){return e._value===t._value})||_t.push(t)}(t),Ut(t),n&&Rt()}}function Ut(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)It(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===Tt&&(++Tt,xt(function(){0==--Tt&&qt()},[]))}function It(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Tt,xt(Pt,[n,t,e])}else t._listeners.push(e)}function Pt(t,e,n){try{zt=e;var r,i=e._value;e._state?r=t(i):(Mt.length&&(Mt=[]),r=t(i),-1===Mt.indexOf(i)&&function(t){for(var e=_t.length;e;)if(_t[--e]._value===t._value)return void _t.splice(e,1)}(e)),n.resolve(r)}catch(t){n.reject(t)}finally{zt=null,0==--Tt&&qt(),--n.psd.ref||n.psd.finalize()}}function Dt(t,e){var n=e?e._numPrev+1:0;n<at&&(t._prev=e,t._numPrev=n)}function Vt(){Ft()&&Rt()}function Ft(){var t=bt;return bt=!1,wt=!1,t}function Rt(){var t,e,n;do{for(;Et.length>0;)for(t=Et,Et=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(Et.length>0);bt=!0,wt=!0}function qt(){var t=_t;_t=[],t.forEach(function(t){t._PSD.onunhandled.call(null,t._value,t)});for(var e=Nt.slice(0),n=e.length;n;)e[--n]()}function Ht(t){return new Ot(ot,!1,t)}function Gt(t,e){var n=St;return function(){var r=Ft(),i=St;try{return ne(n,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{ne(i,!1),r&&Rt()}}}c(Ot.prototype,{then:jt,_then:function(t,e){It(this,new Ct(null,null,t,e,St))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return"function"==typeof e?this.then(null,function(t){return t instanceof e?n(t):Ht(t)}):this.then(null,function(t){return t&&t.name===e?n(t):Ht(t)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),Ht(e)})},stack:{get:function(){if(this._stack)return this._stack;try{vt=!0;var t=function t(e,n,r){if(n.length===r)return n;var i="";if(!1===e._state){var s,o,a=e._value;null!=a?(s=a.name||"Error",o=a.message||a,i=V(a,0)):(s=a,o=""),n.push(s+(o?": "+o:"")+i)}return B&&((i=V(e._stackHolder,2))&&-1===n.indexOf(i)&&n.push(i),e._prev&&t(e._prev,n,r)),n}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{vt=!1}}},timeout:function(t,e){var n=this;return t<1/0?new Ot(function(r,i){var s=setTimeout(function(){return i(new X.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,s))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(Ot.prototype,Symbol.toStringTag,"Promise"),At.env=re(),c(Ot,{all:function(){var t=C.apply(null,arguments).map(te);return new Ot(function(e,n){0===t.length&&e([]);var r=t.length;t.forEach(function(i,s){return Ot.resolve(i).then(function(n){t[s]=n,--r||e(t)},n)})})},resolve:function(t){if(t instanceof Ot)return t;if(t&&"function"==typeof t.then)return new Ot(function(e,n){t.then(e,n)});var e=new Ot(ot,!0,t);return Dt(e,zt),e},reject:Ht,race:function(){var t=C.apply(null,arguments).map(te);return new Ot(function(e,n){t.map(function(t){return Ot.resolve(t).then(e,n)})})},PSD:{get:function(){return St},set:function(t){return St=t}},newPSD:Qt,usePSD:ie,scheduler:{get:function(){return xt},set:function(t){xt=t}},rejectionMapper:{get:function(){return kt},set:function(t){kt=t}},follow:function(t,e){return new Ot(function(n,r){return Qt(function(e,n){var r=St;r.unhandleds=[],r.onunhandled=n,r.finalize=tt(function(){var t=this;!function(t){Nt.push(function e(){t(),Nt.splice(Nt.indexOf(e),1)}),++Tt,xt(function(){0==--Tt&&qt()},[])}(function(){0===t.unhandleds.length?e():n(t.unhandleds[0])})},r.finalize),t()},e,n,r)})}});var Wt={awaits:0,echoes:0,id:0},Kt=0,Lt=[],Xt=0,Yt=0,Zt=0;function Qt(t,e,n,r){var i=St,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Zt;var a=At.env;s.env=yt?{Promise:Ot,PromiseProp:{value:Ot,configurable:!0,writable:!0},all:Ot.all,race:Ot.race,resolve:Ot.resolve,reject:Ot.reject,nthen:oe(a.nthen,s),gthen:oe(a.gthen,s)}:{},e&&o(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=ie(s,t,n,r);return 0===s.ref&&s.finalize(),u}function Jt(){return Wt.id||(Wt.id=++Kt),++Wt.awaits,Wt.echoes+=ut,Wt.id}function $t(t){!Wt.awaits||t&&t!==Wt.id||(0==--Wt.awaits&&(Wt.id=0),Wt.echoes=Wt.awaits*ut)}function te(t){return Wt.echoes&&t&&t.constructor===mt?(Jt(),t.then(function(t){return $t(),t},function(t){return $t(),he(t)})):t}function ee(){var t=Lt[Lt.length-1];Lt.pop(),ne(t,!1)}function ne(t,e){var n=St;if((e?!Wt.echoes||Xt++&&t===St:!Xt||--Xt&&t===St)||function(t){dt.call(ct,t)}(e?function(t){++Yt,Wt.echoes&&0!=--Wt.echoes||(Wt.echoes=Wt.id=0),Lt.push(St),ne(t,!0)}.bind(null,t):ee),t!==St&&(St=t,n===At&&(At.env=re()),yt)){var r=At.env.Promise,i=t.env;lt.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(s,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject)}}function re(){var t=s.Promise;return yt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:t.all,race:t.race,resolve:t.resolve,reject:t.reject,nthen:lt.then,gthen:t.prototype.then}:{}}function ie(t,e,n,r,i){var s=St;try{return ne(t,!0),e(n,r,i)}finally{ne(s,!1)}}function se(t,e,n){return"function"!=typeof t?t:function(){var r=St;n&&Jt(),ne(e,!0);try{return t.apply(this,arguments)}finally{ne(r,!1)}}}function oe(t,e){return function(n,r){return t.call(this,se(n,e,!1),se(r,e,!1))}}var ae="unhandledrejection";function ue(t,e){var n;try{n=e.onuncatched(t)}catch(t){}if(!1!==n)try{var r,i={promise:e,reason:t};if(s.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(ae,!0,!0),o(r,i)):s.CustomEvent&&o(r=new CustomEvent(ae,{detail:i}),i),r&&s.dispatchEvent&&(dispatchEvent(r),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(r)}catch(t){}r.defaultPrevented||console.warn("Unhandled rejection: "+(t.stack||t))}catch(t){}}var he=Ot.reject;function ce(t){var e={},n=function(n,r){if(r){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return e[n].subscribe.apply(null,s),t}if("string"==typeof n)return e[n]};n.addEventType=a;for(var s=1,o=arguments.length;s<o;++s)a(arguments[s]);return n;function a(t,s,o){if("object"==typeof t)return function(t){r(t).forEach(function(e){var n=t[e];if(i(n))a(e,t[e][0],t[e][1]);else{if("asap"!==n)throw new X.InvalidArgument("Invalid event config");var r=a(e,J,function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach(function(t){x(function(){t.apply(null,e)})})})}})}(t);s||(s=it),o||(o=Q);var u={subscribers:[],fire:o,subscribe:function(t){-1===u.subscribers.indexOf(t)&&(u.subscribers.push(t),u.fire=s(u.fire,t))},unsubscribe:function(t){u.subscribers=u.subscribers.filter(function(e){return e!==t}),u.fire=u.subscribers.reduce(s,o)}};return e[t]=n[t]=u,u}}var le,fe=String.fromCharCode(65535),de=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(t){return fe}}(),me=-1/0,pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ye="String expected.",ve=[],ge="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),xe=ge,be=ge,we=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)};function _e(t,e){var n,a,u,l=_e.dependencies,d=o({addons:_e.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange},e),m=d.addons,p=d.autoOpen,x=d.indexedDB,k=d.IDBKeyRange,S=this._dbSchema={},N=[],O=[],U={},I=null,P=null,F=!1,R=null,q=!1,H="readwrite",K=this,L=new Ot(function(t){n=t}),Y=new Ot(function(t,e){a=e}),Z=!0,tt=!!Ce(x);function it(t){this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function ot(t,e,n){var i=K._createTransaction(H,O,S);i.create(e),i._completion.catch(n);var s=i._reject.bind(i);Qt(function(){St.trans=i,0===t?(r(S).forEach(function(t){at(e,t,S[t].primKey,S[t].indexes)}),Ot.follow(function(){return K.on.populate.fire(i)}).catch(s)):function(t,e,n){var i=[],s=N.filter(function(e){return e._cfg.version===t})[0];if(!s)throw new X.Upgrade("Dexie specification of currently installed DB version is missing");S=K._dbSchema=s._cfg.dbschema;var o=!1;return N.filter(function(e){return e._cfg.version>t}).forEach(function(t){i.push(function(){var r=S,i=t._cfg.dbschema;Nt(r,n),Nt(i,n),S=K._dbSchema=i;var s=function(t,e){var n={del:[],add:[],change:[]};for(var r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],s=e[r];if(i){var o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==s.primKey.src)o.recreate=!0,n.change.push(o);else{var a=i.idxByName,u=s.idxByName;for(var h in a)u[h]||o.del.push(h);for(h in u){var c=a[h],l=u[h];c?c.src!==l.src&&o.change.push(l):o.add.push(l)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}(r,i);if(s.add.forEach(function(t){at(n,t[0],t[1].primKey,t[1].indexes)}),s.change.forEach(function(t){if(t.recreate)throw new X.Upgrade("Not yet support for changing primary key");var e=n.objectStore(t.name);t.add.forEach(function(t){ut(e,t)}),t.change.forEach(function(t){e.deleteIndex(t.name),ut(e,t)}),t.del.forEach(function(t){e.deleteIndex(t)})}),t._cfg.contentUpgrade)return o=!0,Ot.follow(function(){t._cfg.contentUpgrade(e)})}),i.push(function(e){o&&xe||function(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];null==t[r]&&e.db.deleteObjectStore(r)}}(t._cfg.dbschema,e)})}),function t(){return i.length?Ot.resolve(i.shift()(e.idbtrans)).then(t):Ot.resolve()}().then(function(){!function(t,e){r(t).forEach(function(n){e.db.objectStoreNames.contains(n)||at(e,n,t[n].primKey,t[n].indexes)})}(S,n)})}(t,i,e).catch(s)})}function at(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(t){ut(i,t)}),i}function ut(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ht(t,e,n){this.name=t,this.schema=e,this._tx=n,this.hook=U[t]?U[t].hook:ce(null,{creating:[et,Q],reading:[$,J],updating:[rt,Q],deleting:[nt,Q]})}function ct(t,e,n){return(n?Se:ke)(function(n){t.push(n),e&&e()})}function lt(t,e,n,r,i){return new Ot(function(s,o){var a=n.length,u=a-1;if(0===a)return s();if(r){var h,c=Se(o),l=ze(null);w(function(){for(var r=0;r<a;++r){h={onsuccess:null,onerror:null};var o=n[r];i.call(h,o[0],o[1],e);var f=t.delete(o[0]);f._hookCtx=h,f.onerror=c,f.onsuccess=r===u?ze(s):l}},function(t){throw h.onerror&&h.onerror(t),t})}else for(var f=0;f<a;++f){var d=t.delete(n[f]);d.onerror=ke(o),f===u&&(d.onsuccess=Gt(function(){return s()}))}})}function ft(t,e,n,r){var i=this;this.db=K,this.mode=t,this.storeNames=e,this.idbtrans=null,this.on=ce(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ot(function(t,e){i._resolve=t,i._reject=e}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(t){var e=i.active;return i.active=!1,i.on.error.fire(t),i.parent?i.parent._reject(t):e&&i.idbtrans&&i.idbtrans.abort(),he(t)})}function dt(t,e,n){this._ctx={table:t,index:":id"===e?null:e,or:n}}function yt(t,e){var n=null,r=null;if(e)try{n=e()}catch(t){r=t}var i=t._ctx,s=i.table;this._ctx={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:s.hook.reading.fire}}function vt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function gt(t,e){return t._cfg.version-e._cfg.version}function xt(t,e,n){e.forEach(function(e){var r=n[e];t.forEach(function(t){e in t||(t===ft.prototype||t instanceof ft?f(t,e,{get:function(){return this.table(e)}}):t[e]=new ht(e,r))})})}function bt(t,e,n,r,i,s){var o=Gt(s?function(t,e,r){return n(s(t),e,r)}:n,i);t.onerror||(t.onerror=ke(i)),t.onsuccess=function(t,e){return function(){try{t.apply(this,arguments)}catch(t){e(t)}}}(e?function(){var n=t.result;if(n){var s=function(){n.continue()};e(n,function(t){s=t},r,i)&&o(n.value,n,function(t){s=t}),s()}else r()}:function(){var e=t.result;if(e){var n=function(){e.continue()};o(e.value,e,function(t){n=t}),n()}else r()},i)}function wt(t,e){return x.cmp(t,e)}function _t(t,e){return wt(t,e)<0?t:e}function Mt(t,e){return wt(t,e)>0?t:e}function zt(t,e){return x.cmp(t,e)}function kt(t,e){return x.cmp(e,t)}function At(t,e){return t<e?-1:t===e?0:1}function Et(t,e){return t>e?-1:t===e?0:1}function Tt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}function Nt(t,e){for(var n=e.db.objectStoreNames,r=0;r<n.length;++r){var i=n[r],o=e.objectStore(i);u="getAll"in o;for(var a=0;a<o.indexNames.length;++a){var h=o.indexNames[a],c=o.index(h).keyPath,l="string"==typeof c?c:"["+y(c).join("+")+"]";if(t[i]){var f=t[i].idxByName[l];f&&(f.name=h)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(u=!1)}function jt(t){K.on("blocked").fire(t),ve.filter(function(t){return t.name===K.name&&t!==K&&!t._vcFired}).map(function(e){return e.on("versionchange").fire(t)})}this.version=function(t){if(I||F)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=N.filter(function(e){return e._cfg.version===t})[0];return e||(e=new it(t),N.push(e),N.sort(gt),Z=!1,e)},o(it.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,t):t;var e={};N.forEach(function(t){o(e,t._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(e,n),S=K._dbSchema=n,[U,K,ft.prototype].forEach(function(t){for(var e in t)t[e]instanceof ht&&delete t[e]}),xt([U,K,ft.prototype,this._cfg.tables],r(n),n),O=r(n),this},upgrade:function(t){return this._cfg.contentUpgrade=t,this},_parseStoresSpec:function(t,e){r(t).forEach(function(n){if(null!==t[n]){var r={},s=function(t){var e=[];return t.split(",").forEach(function(t){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;e.push(new Ne(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),i(r),/\./.test(t)))}),e}(t[n]),o=s.shift();if(o.multi)throw new X.Schema("Primary key cannot be multi-valued");o.keyPath&&M(r,o.keyPath,o.auto?0:o.keyPath),s.forEach(function(t){if(t.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string");M(r,t.keyPath,t.compound?t.keyPath.map(function(){return""}):"")}),e[n]=new Oe(n,o,s,r)}})}}),this._allTables=U,this._createTransaction=function(t,e,n,r){return new ft(t,e,n,r)},this._whenReady=function(t){return q||St.letThrough?t():new Ot(function(t,e){if(!F){if(!p)return void e(new X.DatabaseClosed);K.open().catch(Q)}L.then(t,e)}).then(t)},this.verno=0,this.open=function(){if(F||I)return L.then(function(){return P?he(P):K});B&&(Y._stackHolder=D()),F=!0,P=null,q=!1;var e=n,i=null;return Ot.race([Y,new Ot(function(e,n){if(!x)throw new X.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var s=Z?x.open(t):x.open(t,Math.round(10*K.verno));if(!s)throw new X.MissingAPI("IndexedDB API not available");s.onerror=ke(n),s.onblocked=Gt(jt),s.onupgradeneeded=Gt(function(e){if(i=s.transaction,Z&&!K._allowEmptyDB){s.onerror=Ee,i.abort(),s.result.close();var r=x.deleteDatabase(t);r.onsuccess=r.onerror=Gt(function(){n(new X.NoSuchDatabase("Database "+t+" doesnt exist"))})}else i.onerror=ke(n),ot((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,i,n)},n),s.onsuccess=Gt(function(){if(i=null,I=s.result,ve.push(K),Z)!function(){if(K.verno=I.version/10,K._dbSchema=S={},0!==(O=y(I.objectStoreNames,0)).length){var t=I.transaction(je(O),"readonly");O.forEach(function(e){for(var n=t.objectStore(e),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),s=new Ne(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),o=[],a=0;a<n.indexNames.length;++a){var u=n.index(n.indexNames[a]);i=(r=u.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var h=new Ne(u.name,r,!!u.unique,!!u.multiEntry,!1,r&&"string"!=typeof r,i);o.push(h)}S[e]=new Oe(e,s,o,{})}),xt([U],r(S),S)}}();else if(I.objectStoreNames.length>0)try{Nt(S,I.transaction(je(I.objectStoreNames),"readonly"))}catch(t){}I.onversionchange=Gt(function(t){K._vcFired=!0,K.on("versionchange").fire(t)}),tt||"__dbnames"===t||le.dbnames.put({name:t}).catch(Q),e()},n)})]).then(function(){return R=[],Ot.resolve(_e.vip(K.on.ready.fire)).then(function t(){if(R.length>0){var e=R.reduce(st,Q);return R=[],Ot.resolve(_e.vip(e)).then(t)}})}).finally(function(){R=null}).then(function(){return F=!1,K}).catch(function(t){try{i&&i.abort()}catch(t){}return F=!1,K.close(),he(P=t)}).finally(function(){q=!0,e()})},this.close=function(){var t=ve.indexOf(K);if(t>=0&&ve.splice(t,1),I){try{I.close()}catch(t){}I=null}p=!1,P=new X.DatabaseClosed,F&&a(P),L=new Ot(function(t){n=t}),Y=new Ot(function(t,e){a=e})},this.delete=function(){var e=arguments.length>0;return new Ot(function(n,r){if(e)throw new X.InvalidArgument("Arguments not allowed in db.delete()");function i(){K.close();var e=x.deleteDatabase(t);e.onsuccess=Gt(function(){tt||le.dbnames.delete(t).catch(Q),n()}),e.onerror=ke(r),e.onblocked=jt}F?L.then(i):i()})},this.backendDB=function(){return I},this.isOpen=function(){return null!==I},this.hasBeenClosed=function(){return P&&P instanceof X.DatabaseClosed},this.hasFailed=function(){return null!==P},this.dynamicallyOpened=function(){return Z},this.name=t,c(this,{tables:{get:function(){return r(U).map(function(t){return U[t]})}}}),this.on=ce(this,"populate","blocked","versionchange",{ready:[st,Q]}),this.on.ready.subscribe=v(this.on.ready.subscribe,function(t){return function(e,n){_e.vip(function(){q?(P||Ot.resolve().then(e),n&&t(e)):R?(R.push(e),n&&t(e)):(t(e),n||t(function t(){K.on.ready.unsubscribe(e),K.on.ready.unsubscribe(t)}))})}}),this.transaction=function(){var t=function(t,e,n){var r=arguments.length;if(r<2)throw new X.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,A(i),n]}.apply(this,arguments);return this._transaction.apply(this,t)},this._transaction=function(t,e,n){var r=St.trans;r&&r.db===K&&-1===t.indexOf("!")||(r=null);var i=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{var s=e.map(function(t){var e=t instanceof ht?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e});if("r"==t||"readonly"==t)t="readonly";else{if("rw"!=t&&t!=H)throw new X.InvalidArgument("Invalid transaction mode: "+t);t=H}if(r){if("readonly"===r.mode&&t===H){if(!i)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach(function(t){if(r&&-1===r.storeNames.indexOf(t)){if(!i)throw new X.SubTransaction("Table "+t+" not included in parent transaction.");r=null}}),i&&r&&!r.active&&(r=null)}}catch(t){return r?r._promise(null,function(e,n){n(t)}):he(t)}return r?r._promise(t,o,"lock"):St.trans?ie(St.transless,function(){return K._whenReady(o)}):K._whenReady(o);function o(){return Ot.resolve().then(function(){var e,i=St.transless||St,o=K._createTransaction(t,s,S,r),a={trans:o,transless:i};r?o.idbtrans=r.idbtrans:o.create(),n.constructor===pt&&Jt();var u=Ot.follow(function(){if(e=n.call(o,o))if(e.constructor===mt){var t=$t.bind(null,null);e.then(t,t)}else"function"==typeof e.next&&"function"==typeof e.throw&&(e=Te(e))},a);return(e&&"function"==typeof e.then?Ot.resolve(e).then(function(t){return o.active?t:he(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):u.then(function(){return e})).then(function(t){return r&&o._resolve(),o._completion.then(function(){return t})}).catch(function(t){return o._reject(t),he(t)})})}},this.table=function(t){if(!h(U,t))throw new X.InvalidTable("Table "+t+" does not exist");return U[t]},c(ht.prototype,{_trans:function(t,e,n){var r=this._tx||St.trans;return r&&r.db===K?r===St.trans?r._promise(t,e,n):Qt(function(){return r._promise(t,e,n)},{trans:r,transless:St.transless||St}):function t(e,n,r){if(q||St.letThrough){var i=K._createTransaction(e,n,S);try{i.create()}catch(t){return he(t)}return i._promise(e,function(t,e){return Qt(function(){return St.trans=i,r(t,e,i)})}).then(function(t){return i._completion.then(function(){return t})})}if(!F){if(!p)return he(new X.DatabaseClosed);K.open().catch(Q)}return L.then(function(){return t(e,n,r)})}(t,[this.name],e)},_idbstore:function(t,e,n){var r=this.name;return this._trans(t,function(t,n,i){if(-1===i.storeNames.indexOf(r))throw new X.NotFound("Table"+r+" not part of transaction");return e(t,n,i.idbtrans.objectStore(r),i)},n)},get:function(t,e){if(t&&t.constructor===Object)return this.where(t).first(e);var n=this;return this._idbstore("readonly",function(e,r,i){var s=i.get(t);s.onerror=ke(r),s.onsuccess=Gt(function(){e(n.hook.reading.fire(s.result))},r)}).then(e)},where:function(t){if("string"==typeof t)return new dt(this,t);if(i(t))return new dt(this,"["+t.join("+")+"]");var e=r(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&e.every(function(e){return t.keyPath.indexOf(e)>=0})&&t.keyPath.every(function(t){return e.indexOf(t)>=0})})[0];if(n&&de!==fe)return this.where(n.name).equals(n.keyPath.map(function(e){return t[e]}));n||console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var s=this.schema.idxByName,o=e.reduce(function(e,n){return[e[0]||s[n],e[0]||!s[n]?Tt(e[1],function(e){return""+_(e,n)==""+t[n]}):e[1]]},[null,null]),a=o[0];return a?this.where(a.name).equals(t[a.keyPath]).filter(o[1]):n?this.filter(o[1]):this.where(e).equals("")},count:function(t){return this.toCollection().count(t)},offset:function(t){return this.toCollection().offset(t)},limit:function(t){return this.toCollection().limit(t)},reverse:function(){return this.toCollection().reverse()},filter:function(t){return this.toCollection().and(t)},each:function(t){return this.toCollection().each(t)},toArray:function(t){return this.toCollection().toArray(t)},orderBy:function(t){return new yt(new dt(this,i(t)?"["+t.join("+")+"]":t))},toCollection:function(){return new yt(new dt(this))},mapToClass:function(t,e){this.schema.mappedClass=t;var n=Object.create(t.prototype);e&&Me(n,e),this.schema.instanceTemplate=n;var r=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(h(e,r))try{n[r]=e[r]}catch(t){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t},defineClass:function(t){return this.mapToClass(_e.defineClass(t),t)},bulkDelete:function(t){return this.hook.deleting.fire===Q?this._idbstore(H,function(e,n,r,i){e(lt(r,i,t,!1,Q))}):this.where(":id").anyOf(t).delete().then(function(){})},bulkPut:function(t,e){var n=this;return this._idbstore(H,function(r,i,s){if(!s.keyPath&&!n.schema.primKey.auto&&!e)throw new X.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(s.keyPath&&e)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return r();var o,a,u=function(t){0===h.length?r(t):i(new W(n.name+".bulkPut(): "+h.length+" of "+c+" operations failed",h))},h=[],c=t.length,l=n;if(n.hook.creating.fire===Q&&n.hook.updating.fire===Q){a=ct(h);for(var f=0,d=t.length;f<d;++f)(o=e?s.put(t[f],e[f]):s.put(t[f])).onerror=a;o.onerror=ct(h,u),o.onsuccess=Ae(u)}else{var m=e||s.keyPath&&t.map(function(t){return _(t,s.keyPath)}),p=m&&b(m,function(e,n){return null!=e&&[e,t[n]]});(m?l.where(":id").anyOf(m.filter(function(t){return null!=t})).modify(function(){this.value=p[this.primKey],p[this.primKey]=null}).catch(G,function(t){h=t.failures}).then(function(){for(var n=[],r=e&&[],i=m.length-1;i>=0;--i){var s=m[i];(null==s||p[s])&&(n.push(t[i]),e&&r.push(s),null!=s&&(p[s]=null))}return n.reverse(),e&&r.reverse(),l.bulkAdd(n,r)}).then(function(t){var e=m[m.length-1];return null!=e?e:t}):l.bulkAdd(t)).then(u).catch(W,function(t){h=h.concat(t.failures),u()}).catch(i)}},"locked")},bulkAdd:function(t,e){var n=this,r=this.hook.creating.fire;return this._idbstore(H,function(i,s,o,a){if(!o.keyPath&&!n.schema.primKey.auto&&!e)throw new X.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(o.keyPath&&e)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return i();function u(t){0===f.length?i(t):s(new W(n.name+".bulkAdd(): "+f.length+" of "+d+" operations failed",f))}var h,c,l,f=[],d=t.length;if(r!==Q){var m,p=o.keyPath;c=ct(f,null,!0),l=ze(null),w(function(){for(var n=0,i=t.length;n<i;++n){m={onerror:null,onsuccess:null};var s=e&&e[n],u=t[n],f=e?s:p?_(u,p):void 0,d=r.call(m,f,u,a);null==f&&null!=d&&(p?M(u=E(u),p,d):s=d),(h=null!=s?o.add(u,s):o.add(u))._hookCtx=m,n<i-1&&(h.onerror=c,m.onsuccess&&(h.onsuccess=l))}},function(t){throw m.onerror&&m.onerror(t),t}),h.onerror=ct(f,u,!0),h.onsuccess=ze(u)}else{c=ct(f);for(var y=0,v=t.length;y<v;++y)(h=e?o.add(t[y],e[y]):o.add(t[y])).onerror=c;h.onerror=ct(f,u),h.onsuccess=Ae(u)}})},add:function(t,e){var n=this.hook.creating.fire;return this._idbstore(H,function(r,i,s,o){var a={onsuccess:null,onerror:null};if(n!==Q){var u=null!=e?e:s.keyPath?_(t,s.keyPath):void 0,h=n.call(a,u,t,o);null==u&&null!=h&&(s.keyPath?M(t,s.keyPath,h):e=h)}try{var c=null!=e?s.add(t,e):s.add(t);c._hookCtx=a,c.onerror=Se(i),c.onsuccess=ze(function(e){var n=s.keyPath;n&&M(t,n,e),r(e)})}catch(t){throw a.onerror&&a.onerror(t),t}})},put:function(t,e){var n=this,r=this.hook.creating.fire,i=this.hook.updating.fire;if(r!==Q||i!==Q){var s=this.schema.primKey.keyPath,o=void 0!==e?e:s&&_(t,s);return null==o?this.add(t):(t=E(t),this._trans(H,function(){return n.where(":id").equals(o).modify(function(){this.value=t}).then(function(r){return 0===r?n.add(t,e):o})},"locked"))}return this._idbstore(H,function(n,r,i){var s=void 0!==e?i.put(t,e):i.put(t);s.onerror=ke(r),s.onsuccess=Gt(function(e){var r=i.keyPath;r&&M(t,r,e.target.result),n(s.result)})})},delete:function(t){return this.hook.deleting.subscribers.length?this.where(":id").equals(t).delete():this._idbstore(H,function(e,n,r){var i=r.delete(t);i.onerror=ke(n),i.onsuccess=Gt(function(){e(i.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(H,function(t,e,n){var r=n.clear();r.onerror=ke(e),r.onsuccess=Gt(function(){t(r.result)})})},update:function(t,e){if("object"!=typeof e||i(e))throw new X.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||i(t))return this.where(":id").equals(t).modify(e);r(e).forEach(function(n){M(t,n,e[n])});var n=_(t,this.schema.primKey.keyPath);return void 0===n?he(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(e)}}),c(ft.prototype,{_lock:function(){return g(!St.global),++this._reculock,1!==this._reculock||St.global||(St.lockOwnerFor=this),this},_unlock:function(){if(g(!St.global),0==--this._reculock)for(St.global||(St.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{ie(t[1],t[0])}catch(t){}}return this},_locked:function(){return this._reculock&&St.lockOwnerFor!==this},create:function(t){var e=this;if(!this.mode)return this;if(g(!this.idbtrans),!t&&!I)switch(P&&P.name){case"DatabaseClosedError":throw new X.DatabaseClosed(P);case"MissingAPIError":throw new X.MissingAPI(P.message,P);default:throw new X.OpenFailed(P)}if(!this.active)throw new X.TransactionInactive;return g(null===this._completion._state),(t=this.idbtrans=t||I.transaction(je(this.storeNames),this.mode)).onerror=Gt(function(n){Ee(n),e._reject(t.error)}),t.onabort=Gt(function(n){Ee(n),e.active&&e._reject(new X.Abort(t.error)),e.active=!1,e.on("abort").fire(n)}),t.oncomplete=Gt(function(){e.active=!1,e._resolve()}),this},_promise:function(t,e,n){var r=this;if(t===H&&this.mode!==H)return he(new X.ReadOnly("Transaction is readonly"));if(!this.active)return he(new X.TransactionInactive);if(this._locked())return new Ot(function(i,s){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,s)},St])});if(n)return Qt(function(){var t=new Ot(function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)});return t.finally(function(){return r._unlock()}),t._lib=!0,t});var i=new Ot(function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)});return i._lib=!0,i},_root:function(){return this.parent?this.parent._root():this},waitFor:function(t){var e=this._root();if(t=Ot.resolve(t),e._waitingFor)e._waitingFor=e._waitingFor.then(function(){return t});else{e._waitingFor=t,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new Ot(function(n,i){t.then(function(t){return e._waitingQueue.push(Gt(n.bind(null,t)))},function(t){return e._waitingQueue.push(Gt(i.bind(null,t)))}).finally(function(){e._waitingFor===r&&(e._waitingFor=null)})})},abort:function(){this.active&&this._reject(new X.Abort),this.active=!1},tables:{get:function(){return console.warn("Transaction.tables is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+V(D(),1)),function(){return U}.apply(this,arguments)}},table:function(t){return new ht(t,K.table(t).schema,this)}}),c(dt.prototype,function(){function t(t,e,n){var r=t instanceof dt?new yt(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function e(t){return new yt(t,function(){return k.only("")}).limit(0)}function n(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),a=-1,u=0;u<o;++u){var h=e[u];if(h!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],h)<0&&(a=u)}return o<r.length&&"next"===s?t+n.substr(t.length):o<t.length&&"prev"===s?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function r(e,r,i,s){var o,a,u,h,c,l,f,d=i.length;if(!i.every(function(t){return"string"==typeof t}))return t(e,ye);function m(t){o=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),a=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),u="next"===t?At:Et;var e=i.map(function(t){return{lower:a(t),upper:o(t)}}).sort(function(t,e){return u(t.lower,e.lower)});h=e.map(function(t){return t.upper}),c=e.map(function(t){return t.lower}),l=t,f="next"===t?"":s}m("next");var p=new yt(e,function(){return k.bound(h[0],c[d-1]+s)});p._ondirectionchange=function(t){m(t)};var y=0;return p._addAlgorithm(function(t,e,i){var s=t.key;if("string"!=typeof s)return!1;var o=a(s);if(r(o,c,y))return!0;for(var m=null,p=y;p<d;++p){var v=n(s,o,h[p],c[p],u,l);null===v&&null===m?y=p+1:(null===m||u(m,v)>0)&&(m=v)}return e(null!==m?function(){t.continue(m+f)}:i),!1}),p}return{between:function(n,r,i,s){i=!1!==i,s=!0===s;try{return wt(n,r)>0||0===wt(n,r)&&(i||s)&&(!i||!s)?e(this):new yt(this,function(){return k.bound(n,r,!i,!s)})}catch(e){return t(this,pe)}},equals:function(t){return new yt(this,function(){return k.only(t)})},above:function(t){return new yt(this,function(){return k.lowerBound(t,!0)})},aboveOrEqual:function(t){return new yt(this,function(){return k.lowerBound(t)})},below:function(t){return new yt(this,function(){return k.upperBound(t,!0)})},belowOrEqual:function(t){return new yt(this,function(){return k.upperBound(t)})},startsWith:function(e){return"string"!=typeof e?t(this,ye):this.between(e,e+fe,!0,!0)},startsWithIgnoreCase:function(t){return""===t?this.startsWith(t):r(this,function(t,e){return 0===t.indexOf(e[0])},[t],fe)},equalsIgnoreCase:function(t){return r(this,function(t,e){return t===e[0]},[t],"")},anyOfIgnoreCase:function(){var t=C.apply(j,arguments);return 0===t.length?e(this):r(this,function(t,e){return-1!==e.indexOf(t)},t,"")},startsWithAnyOfIgnoreCase:function(){var t=C.apply(j,arguments);return 0===t.length?e(this):r(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},t,fe)},anyOf:function(){var n=C.apply(j,arguments),r=zt;try{n.sort(r)}catch(e){return t(this,pe)}if(0===n.length)return e(this);var i=new yt(this,function(){return k.bound(n[0],n[n.length-1])});i._ondirectionchange=function(t){r="next"===t?zt:kt,n.sort(r)};var s=0;return i._addAlgorithm(function(t,e,i){for(var o=t.key;r(o,n[s])>0;)if(++s===n.length)return e(i),!1;return 0===r(o,n[s])||(e(function(){t.continue(n[s])}),!1)}),i},notEqual:function(t){return this.inAnyRange([[me,t],[t,de]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var e=C.apply(j,arguments);if(0===e.length)return new yt(this);try{e.sort(zt)}catch(e){return t(this,pe)}var n=e.reduce(function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[me,e]]},null);return n.push([e[e.length-1],de]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){if(0===n.length)return e(this);if(!n.every(function(t){return void 0!==t[0]&&void 0!==t[1]&&zt(t[0],t[1])<=0}))return t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var i,s=!r||!1!==r.includeLowers,o=r&&!0===r.includeUppers,a=zt;function u(t,e){return a(t[0],e[0])}try{(i=n.reduce(function(t,e){for(var n=0,r=t.length;n<r;++n){var i=t[n];if(wt(e[0],i[1])<0&&wt(e[1],i[0])>0){i[0]=_t(i[0],e[0]),i[1]=Mt(i[1],e[1]);break}}return n===r&&t.push(e),t},[])).sort(u)}catch(e){return t(this,pe)}var h=0,c=o?function(t){return zt(t,i[h][1])>0}:function(t){return zt(t,i[h][1])>=0},l=s?function(t){return kt(t,i[h][0])>0}:function(t){return kt(t,i[h][0])>=0},f=c,d=new yt(this,function(){return k.bound(i[0][0],i[i.length-1][1],!s,!o)});return d._ondirectionchange=function(t){"next"===t?(f=c,a=zt):(f=l,a=kt),i.sort(u)},d._addAlgorithm(function(t,e,n){for(var r=t.key;f(r);)if(++h===i.length)return e(n),!1;return!!function(t){return!c(t)&&!l(t)}(r)||0!==wt(r,i[h][1])&&0!==wt(r,i[h][0])&&(e(function(){a===zt?t.continue(i[h][0]):t.continue(i[h][1])}),!1)}),d},startsWithAnyOf:function(){var n=C.apply(j,arguments);return n.every(function(t){return"string"==typeof t})?0===n.length?e(this):this.inAnyRange(n.map(function(t){return[t,t+fe]})):t(this,"startsWithAnyOf() only works with strings")}}}),c(yt.prototype,function(){function t(t,e){t.filter=Tt(t.filter,e)}function e(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Tt(r(),e())}:e,t.justLimit=n&&!r}function n(t,e){if(t.isPrimKey)return e;var n=t.table.schema.idxByName[t.index];if(!n)throw new X.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return e.index(n.name)}function i(t,e){var r=n(t,e);return t.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(t.range||null,t.dir+t.unique):r.openCursor(t.range||null,t.dir+t.unique)}function s(t,e,n,r,s){var o=t.replayFilter?Tt(t.filter,t.replayFilter()):t.filter;t.or?function(){var a={},u=0;function c(){2==++u&&n()}function l(t,n,i){if(!o||o(n,i,c,r)){var s=n.primaryKey,u=""+s;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(s)),h(a,u)||(a[u]=!0,e(t,n,i))}}t.or._iterate(l,c,r,s),bt(i(t,s),t.algorithm,l,c,r,!t.keysOnly&&t.valueMapper)}():bt(i(t,s),Tt(t.algorithm,o),e,n,r,!t.keysOnly&&t.valueMapper)}return{_read:function(t,e){var n=this._ctx;return n.error?n.table._trans(null,he.bind(null,n.error)):n.table._idbstore("readonly",t).then(e)},_write:function(t){var e=this._ctx;return e.error?e.table._trans(null,he.bind(null,e.error)):e.table._idbstore(H,t,"locked")},_addAlgorithm:function(t){var e=this._ctx;e.algorithm=Tt(e.algorithm,t)},_iterate:function(t,e,n,r){return s(this._ctx,t,e,n,r)},clone:function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&o(n,t),e._ctx=n,e},raw:function(){return this._ctx.valueMapper=null,this},each:function(t){var e=this._ctx;return this._read(function(n,r,i){s(e,t,n,r,i)})},count:function(t){var e=this._ctx;if(vt(e,!0))return this._read(function(t,r,i){var s=n(e,i),o=e.range?s.count(e.range):s.count();o.onerror=ke(r),o.onsuccess=function(n){t(Math.min(n.target.result,e.limit))}},t);var r=0;return this._read(function(t,n,i){s(e,function(){return++r,!1},function(){t(r)},n,i)},t)},sortBy:function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function s(t,e){return e?s(t[n[e]],e-1):t[r]}var o="next"===this._ctx.dir?1:-1;function a(t,e){var n=s(t,i),r=s(e,i);return n<r?-o:n>r?o:0}return this.toArray(function(t){return t.sort(a)}).then(e)},toArray:function(t){var e=this._ctx;return this._read(function(t,r,i){if(u&&"next"===e.dir&&vt(e,!0)&&e.limit>0){var o=e.table.hook.reading.fire,a=n(e,i),h=e.limit<1/0?a.getAll(e.range,e.limit):a.getAll(e.range);h.onerror=ke(r),h.onsuccess=Ae(o===J?t:function(e){try{t(e.map(o))}catch(t){r(t)}})}else{var c=[];s(e,function(t){c.push(t)},function(){t(c)},r,i)}},t)},offset:function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,vt(n)?e(n,function(){var e=t;return function(t,n){return 0===e||(1===e?(--e,!1):(n(function(){t.advance(e),e=0}),!1))}}):e(n,function(){var e=t;return function(){return--e<0}}),this)},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),e(this._ctx,function(){var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}},!0),this},until:function(e,n){return t(this._ctx,function(t,r,i){return!e(t.value)||(r(i),n)}),this},first:function(t){return this.limit(1).toArray(function(t){return t[0]}).then(t)},last:function(t){return this.reverse().first(t)},filter:function(e){return t(this._ctx,function(t){return e(t.value)}),function(t,e){t.isMatch=Tt(t.isMatch,e)}(this._ctx,e),this},and:function(t){return this.filter(t)},or:function(t){return new dt(this._ctx.table,t,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.key,n)})},eachUniqueKey:function(t){return this._ctx.unique="unique",this.eachKey(t)},eachPrimaryKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.primaryKey,n)})},keys:function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.key)}).then(function(){return n}).then(t)},primaryKeys:function(t){var e=this._ctx;if(u&&"next"===e.dir&&vt(e,!0)&&e.limit>0)return this._read(function(t,r,i){var s=n(e,i),o=e.limit<1/0?s.getAllKeys(e.range,e.limit):s.getAllKeys(e.range);o.onerror=ke(r),o.onsuccess=Ae(t)}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(t,e){r.push(e.primaryKey)}).then(function(){return r}).then(t)},uniqueKeys:function(t){return this._ctx.unique="unique",this.keys(t)},firstKey:function(t){return this.limit(1).keys(function(t){return t[0]}).then(t)},lastKey:function(t){return this.reverse().firstKey(t)},distinct:function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return t(this._ctx,function(t){var e=t.primaryKey.toString(),n=h(r,e);return r[e]=!0,!n}),this},modify:function(t){var e=this,n=this._ctx.table.hook,i=n.updating.fire,s=n.deleting.fire;return this._write(function(n,a,u,c){var l;if("function"==typeof t)l=i===Q&&s===Q?t:function(e){var n=E(e);if(!1===t.call(this,e,this))return!1;if(h(this,"value")){var o=T(n,this.value),a=i.call(this,o,this.primKey,n,c);a&&(e=this.value,r(a).forEach(function(t){M(e,t,a[t])}))}else s.call(this,this.primKey,e,c)};else if(i===Q){var f=r(t),d=f.length;l=function(e){for(var n=!1,r=0;r<d;++r){var i=f[r],s=t[i];_(e,i)!==s&&(M(e,i,s),n=!0)}return n}}else{var m=t;t=z(m),l=function(e){var n=!1,s=i.call(this,t,this.primKey,E(e),c);return s&&o(t,s),r(t).forEach(function(r){var i=t[r];_(e,r)!==i&&(M(e,r,i),n=!0)}),s&&(t=z(m)),n}}var p=0,y=0,v=!1,g=[],x=[],b=null;function k(t){return t&&(g.push(t),x.push(b)),a(new G("Error modifying one or more objects",g,y,x))}function A(){v&&y+g.length===p&&(g.length>0?k():n(y))}e.clone().raw()._iterate(function(t,e){b=e.primaryKey;var n={primKey:e.primaryKey,value:t,onsuccess:null,onerror:null};function r(t){return g.push(t),x.push(n.primKey),A(),!0}if(!1!==l.call(n,t,n)){var i=!h(n,"value");++p,w(function(){var t=i?e.delete():e.update(n.value);t._hookCtx=n,t.onerror=Se(r),t.onsuccess=ze(function(){++y,A()})},r)}else n.onsuccess&&n.onsuccess(n.value)},function(){v=!0,A()},k,u)})},delete:function(){var t=this,e=this._ctx,n=e.range,r=e.table.hook.deleting.fire,i=r!==Q;if(!i&&vt(e)&&(e.isPrimKey&&!be||!n))return this._write(function(t,e,r){var i=ke(e),s=n?r.count(n):r.count();s.onerror=i,s.onsuccess=function(){var o=s.result;w(function(){var e=n?r.delete(n):r.clear();e.onerror=i,e.onsuccess=function(){return t(o)}},function(t){return e(t)})}});var s=i?2e3:1e4;return this._write(function(n,o,a,u){var h=0,c=t.clone({keysOnly:!e.isMatch&&!i}).distinct().limit(s).raw(),l=[],f=function(){return c.each(i?function(t,e){l.push([e.primaryKey,e.value])}:function(t,e){l.push(e.primaryKey)}).then(function(){return i?l.sort(function(t,e){return zt(t[0],e[0])}):l.sort(zt),lt(a,u,l,i,r)}).then(function(){var t=l.length;return l=[],t<s?h+=t:f()})};n(f())})}}}),o(this,{Collection:yt,Table:ht,Transaction:ft,Version:it,WhereClause:dt}),K.on("versionchange",function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+K.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+K.name+"'. Closing db now to resume the delete request."),K.close()}),K.on("blocked",function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+K.name+"') was blocked"):console.warn("Upgrade '"+K.name+"' blocked by other connection holding version "+t.oldVersion/10)}),m.forEach(function(t){t(K)})}function Me(t,e){return r(e).forEach(function(n){var r=function t(e){if("function"==typeof e)return new e;if(i(e))return[t(e[0])];if(e&&"object"==typeof e){var n={};return Me(n,e),n}return e}(e[n]);t[n]=r}),t}function ze(t){return Gt(function(e){var n=e.target,r=n._hookCtx,i=r.value||n.result,s=r&&r.onsuccess;s&&s(i),t&&t(i)},t)}function ke(t){return Gt(function(e){return Ee(e),t(e.target.error),!1})}function Ae(t){return Gt(function(e){t(e.target.result)})}function Se(t){return Gt(function(e){var n=e.target,r=n.error,i=n._hookCtx,s=i&&i.onerror;return s&&s(r),Ee(e),t(r),!1})}function Ee(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}function Te(t){var e=function(e){return t.next(e)},n=s(e),r=s(function(e){return t.throw(e)});function s(t){return function(e){var s=t(e),o=s.value;return s.done?o:o&&"function"==typeof o.then?o.then(n,r):i(o)?Ot.all(o).then(n,r):n(o)}}return s(e)()}function Ne(t,e,n,r,i,s,o){this.name=t,this.keyPath=e,this.unique=n,this.multi=r,this.auto=i,this.compound=s,this.dotted=o;var a="string"==typeof e?e:e&&"["+[].join.call(e,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+a}function Oe(t,e,n,r){this.name=t,this.primKey=e||new Ne,this.indexes=n||[new Ne],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=b(n,function(t){return[t.name,t]})}function je(t){return 1===t.length?t[0]:t}function Ce(t){var e=t&&(t.getDatabaseNames||t.webkitGetDatabaseNames);return e&&e.bind(t)}U(B,we),c(_e,Z),c(_e,{delete:function(t){var e=new _e(t),n=e.delete();return n.onblocked=function(t){return e.on("blocked",t),this},n},exists:function(t){return new _e(t).open().then(function(t){return t.close(),!0}).catch(_e.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(t){var e=Ce(_e.dependencies.indexedDB);return e?new Ot(function(t,n){var r=e();r.onsuccess=function(e){t(y(e.target.result,0))},r.onerror=ke(n)}).then(t):le.dbnames.toCollection().primaryKeys(t)},defineClass:function(){return function(t){t&&o(this,t)}},applyStructure:Me,ignoreTransaction:function(t){return St.trans?ie(St.transless,t):t()},vip:function(t){return Qt(function(){return St.letThrough=!0,t()})},async:function(t){return function(){try{var e=Te(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Ot.resolve(e)}catch(t){return he(t)}}},spawn:function(t,e,n){try{var r=Te(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:Ot.resolve(r)}catch(t){return he(t)}},currentTransaction:{get:function(){return St.trans||null}},waitFor:function(t,e){var n=Ot.resolve("function"==typeof t?_e.ignoreTransaction(t):t).timeout(e||6e4);return St.trans?St.trans.waitFor(n):n},Promise:Ot,debug:{get:function(){return B},set:function(t){U(t,"dexie"===t?function(){return!0}:we)}},derive:d,extend:o,props:c,override:v,Events:ce,getByKeyPath:_,setByKeyPath:M,delByKeyPath:function(t,e){"string"==typeof e?M(t,e,void 0):"length"in e&&[].map.call(e,function(e){M(t,e,void 0)})},shallowClone:z,deepClone:E,getObjectDiff:T,asap:x,maxKey:de,minKey:me,addons:[],connections:ve,MultiModifyError:X.Modify,errnames:K,IndexSpec:Ne,TableSchema:Oe,dependencies:function(){try{return{indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"{version}",version:"{version}".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)}),default:_e,Dexie:_e}),Ot.rejectionMapper=function(t,e){if(!t||t instanceof H||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Y[t.name])return t;var n=new Y[t.name](e||t.message,t);return"stack"in t&&f(n,"stack",{get:function(){return this.inner.stack}}),n},(le=new _e("__dbnames")).version(1).stores({dbnames:"name"}),function(){try{void 0!==typeof localStorage&&void 0!==s.document&&(JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]").forEach(function(t){return le.dbnames.put({name:t}).catch(Q)}),localStorage.removeItem("Dexie.DatabaseNames"))}catch(t){}}(),e.a=_e}).call(this,n(3),n(8).setImmediate)},function(t,e,n){var r=n(11),i=n(12),s=n(13),o=n(14),a=n(15),u=n(16),h=n(17);h.alea=r,h.xor128=i,h.xorwow=s,h.xorshift7=o,h.xor4096=a,h.tychei=u,t.exports=h},function(t,e,n){var r;!function(){"use strict";var i=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,o=1/6,a=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;function h(t){var e;e="function"==typeof t?t:t?function(){var t=0,e=0,n=0,r=1,i=function(){var t=4022871197;return function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)}}();t=i(" "),e=i(" "),n=i(" ");for(var s=0;s<arguments.length;s++)(t-=i(arguments[s]))<0&&(t+=1),(e-=i(arguments[s]))<0&&(e+=1),(n-=i(arguments[s]))<0&&(n+=1);return i=null,function(){var i=2091639*t+2.3283064365386963e-10*r;return t=e,e=n,n=i-(r=0|i)}}(t):Math.random,this.p=c(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}function c(t){var e,n=new Uint8Array(256);for(e=0;e<256;e++)n[e]=e;for(e=0;e<255;e++){var r=e+~~(t()*(256-e)),i=n[e];n[e]=n[r],n[r]=i}return n}h.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,e){var n,r,o=this.permMod12,a=this.perm,u=this.grad3,h=0,c=0,l=0,f=(t+e)*i,d=Math.floor(t+f),m=Math.floor(e+f),p=(d+m)*s,y=t-(d-p),v=e-(m-p);y>v?(n=1,r=0):(n=0,r=1);var g=y-n+s,x=v-r+s,b=y-1+2*s,w=v-1+2*s,_=255&d,M=255&m,z=.5-y*y-v*v;if(z>=0){var k=3*o[_+a[M]];h=(z*=z)*z*(u[k]*y+u[k+1]*v)}var A=.5-g*g-x*x;if(A>=0){var S=3*o[_+n+a[M+r]];c=(A*=A)*A*(u[S]*g+u[S+1]*x)}var E=.5-b*b-w*w;if(E>=0){var T=3*o[_+1+a[M+1]];l=(E*=E)*E*(u[T]*b+u[T+1]*w)}return 70*(h+c+l)},noise3D:function(t,e,n){var r,i,s,a,u,h,c,l,f,d,m=this.permMod12,p=this.perm,y=this.grad3,v=(t+e+n)*(1/3),g=Math.floor(t+v),x=Math.floor(e+v),b=Math.floor(n+v),w=(g+x+b)*o,_=t-(g-w),M=e-(x-w),z=n-(b-w);_>=M?M>=z?(u=1,h=0,c=0,l=1,f=1,d=0):_>=z?(u=1,h=0,c=0,l=1,f=0,d=1):(u=0,h=0,c=1,l=1,f=0,d=1):M<z?(u=0,h=0,c=1,l=0,f=1,d=1):_<z?(u=0,h=1,c=0,l=0,f=1,d=1):(u=0,h=1,c=0,l=1,f=1,d=0);var k=_-u+o,A=M-h+o,S=z-c+o,E=_-l+2*o,T=M-f+2*o,N=z-d+2*o,O=_-1+.5,j=M-1+.5,C=z-1+.5,B=255&g,U=255&x,I=255&b,P=.6-_*_-M*M-z*z;if(P<0)r=0;else{var D=3*m[B+p[U+p[I]]];r=(P*=P)*P*(y[D]*_+y[D+1]*M+y[D+2]*z)}var V=.6-k*k-A*A-S*S;if(V<0)i=0;else{var F=3*m[B+u+p[U+h+p[I+c]]];i=(V*=V)*V*(y[F]*k+y[F+1]*A+y[F+2]*S)}var R=.6-E*E-T*T-N*N;if(R<0)s=0;else{var q=3*m[B+l+p[U+f+p[I+d]]];s=(R*=R)*R*(y[q]*E+y[q+1]*T+y[q+2]*N)}var H=.6-O*O-j*j-C*C;if(H<0)a=0;else{var G=3*m[B+1+p[U+1+p[I+1]]];a=(H*=H)*H*(y[G]*O+y[G+1]*j+y[G+2]*C)}return 32*(r+i+s+a)},noise4D:function(t,e,n,r){var i,s,o,h,c,l,f,d,m,p,y,v,g,x,b,w,_,M=this.perm,z=this.grad4,k=(t+e+n+r)*a,A=Math.floor(t+k),S=Math.floor(e+k),E=Math.floor(n+k),T=Math.floor(r+k),N=(A+S+E+T)*u,O=t-(A-N),j=e-(S-N),C=n-(E-N),B=r-(T-N),U=0,I=0,P=0,D=0;O>j?U++:I++,O>C?U++:P++,O>B?U++:D++,j>C?I++:P++,j>B?I++:D++,C>B?P++:D++;var V=O-(l=U>=3?1:0)+u,F=j-(f=I>=3?1:0)+u,R=C-(d=P>=3?1:0)+u,q=B-(m=D>=3?1:0)+u,H=O-(p=U>=2?1:0)+2*u,G=j-(y=I>=2?1:0)+2*u,W=C-(v=P>=2?1:0)+2*u,K=B-(g=D>=2?1:0)+2*u,L=O-(x=U>=1?1:0)+3*u,X=j-(b=I>=1?1:0)+3*u,Y=C-(w=P>=1?1:0)+3*u,Z=B-(_=D>=1?1:0)+3*u,Q=O-1+4*u,J=j-1+4*u,$=C-1+4*u,tt=B-1+4*u,et=255&A,nt=255&S,rt=255&E,it=255&T,st=.6-O*O-j*j-C*C-B*B;if(st<0)i=0;else{var ot=M[et+M[nt+M[rt+M[it]]]]%32*4;i=(st*=st)*st*(z[ot]*O+z[ot+1]*j+z[ot+2]*C+z[ot+3]*B)}var at=.6-V*V-F*F-R*R-q*q;if(at<0)s=0;else{var ut=M[et+l+M[nt+f+M[rt+d+M[it+m]]]]%32*4;s=(at*=at)*at*(z[ut]*V+z[ut+1]*F+z[ut+2]*R+z[ut+3]*q)}var ht=.6-H*H-G*G-W*W-K*K;if(ht<0)o=0;else{var ct=M[et+p+M[nt+y+M[rt+v+M[it+g]]]]%32*4;o=(ht*=ht)*ht*(z[ct]*H+z[ct+1]*G+z[ct+2]*W+z[ct+3]*K)}var lt=.6-L*L-X*X-Y*Y-Z*Z;if(lt<0)h=0;else{var ft=M[et+x+M[nt+b+M[rt+w+M[it+_]]]]%32*4;h=(lt*=lt)*lt*(z[ft]*L+z[ft+1]*X+z[ft+2]*Y+z[ft+3]*Z)}var dt=.6-Q*Q-J*J-$*$-tt*tt;if(dt<0)c=0;else{var mt=M[et+1+M[nt+1+M[rt+1+M[it+1]]]]%32*4;c=(dt*=dt)*dt*(z[mt]*Q+z[mt+1]*J+z[mt+2]*$+z[mt+3]*tt)}return 27*(i+s+o+h+c)}},h._buildPermutationTable=c,void 0===(r=function(){return h}.call(e,n,e,t))||(t.exports=r),e.SimplexNoise=h,t.exports=h}()},function(t,e){var n=4,r=.001,i=1e-7,s=10,o=11,a=1/(o-1),u="function"==typeof Float32Array;function h(t,e){return 1-3*e+3*t}function c(t,e){return 3*e-6*t}function l(t){return 3*t}function f(t,e,n){return((h(e,n)*t+c(e,n))*t+l(e))*t}function d(t,e,n){return 3*h(e,n)*t*t+2*c(e,n)*t+l(e)}function m(t){return t}t.exports=function(t,e,h,c){if(!(0<=t&&t<=1&&0<=h&&h<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&h===c)return m;for(var l=u?new Float32Array(o):new Array(o),p=0;p<o;++p)l[p]=f(p*a,t,h);function y(e){for(var u=0,c=1,m=o-1;c!==m&&l[c]<=e;++c)u+=a;var p=u+(e-l[--c])/(l[c+1]-l[c])*a,y=d(p,t,h);return y>=r?function(t,e,r,i){for(var s=0;s<n;++s){var o=d(e,r,i);if(0===o)return e;e-=(f(e,r,i)-t)/o}return e}(e,p,t,h):0===y?p:function(t,e,n,r,o){var a,u,h=0;do{(a=f(u=e+(n-e)/2,r,o)-t)>0?n=u:e=u}while(Math.abs(a)>i&&++h<s);return u}(e,u,u+a,t,h)}return function(t){return 0===t?0:1===t?1:f(y(t),e,c)}}},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function s(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new s(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new s(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(9),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(3))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i=1,s={},o=!1,a=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){c(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&c(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){c(t.data)},r=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;r=function(e){var n=a.createElement("script");n.onreadystatechange=function(){c(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():r=function(t){setTimeout(c,0,t)},u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return s[i]=o,r(i),i++},u.clearImmediate=h}function h(t){delete s[t]}function c(t){if(o)setTimeout(c,0,t);else{var e=s[t];if(e){o=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{h(t),o=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(3),n(10))},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var u,h=[],c=!1,l=-1;function f(){c&&u&&(c=!1,u.length?h=u.concat(h):l=-1,h.length&&d())}function d(){if(!c){var t=a(f);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new m(t,e)),1!==h.length||c||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var n=new function(t){var e=this,n=function(){var t=4022871197;return function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)}}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.alea=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.xor128=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.xorwow=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.xorshift7=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,s=-32;s<u;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,i=0==(n=a[127&s]^=r+o)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=o,t.X=a,t.i=i}(e,t)}(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.xor4096=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=a:n(0)&&n(2)?void 0===(r=function(){return a}.call(e,n,e,i))||(i.exports=r):this.tychei=a}(0,"object"==typeof t&&t,n(0))}).call(this,n(1)(t))},function(t,e,n){var r;!function(i,s){var o,a=this,u=256,h=6,c="random",l=s.pow(u,h),f=s.pow(2,52),d=2*f,m=u-1;function p(t,e,n){var r=[],p=v(function t(e,n){var r,i=[],s=typeof e;if(n&&"object"==s)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==s?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,g(i)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(u):(t=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(t)),g(t)}catch(t){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,g(i)]}}():t,3),r),x=new function(t){var e,n=t.length,r=this,i=0,s=r.i=r.j=0,o=r.S=[];for(n||(t=[n++]);i<u;)o[i]=i++;for(i=0;i<u;i++)o[i]=o[s=m&s+t[i%n]+(e=o[i])],o[s]=e;(r.g=function(t){for(var e,n=0,i=r.i,s=r.j,o=r.S;t--;)e=o[i=m&i+1],n=n*u+o[m&(o[i]=o[s=m&s+e])+(o[s]=e)];return r.i=i,r.j=s,n})(u)}(r),b=function(){for(var t=x.g(h),e=l,n=0;t<f;)t=(t+n)*u,e*=u,n=x.g(1);for(;t>=d;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|x.g(4)},b.quick=function(){return x.g(4)/4294967296},b.double=b,v(g(x.S),i),(e.pass||n||function(t,e,n,r){return r&&(r.S&&y(r,x),t.state=function(){return y(x,{})}),n?(s[c]=t,e):t})(b,p,"global"in e?e.global:this==s,e.state)}function y(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",i=0;i<r.length;)e[m&i]=m&(n^=19*e[m&i])+r.charCodeAt(i++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(s["seed"+c]=p,v(s.random(),i),"object"==typeof t&&t.exports){t.exports=p;try{o=n(18)}catch(t){}}else void 0===(r=function(){return p}.call(e,n,e,t))||(t.exports=r)}([],Math)},function(t,e){},function(t,e,n){"use strict";function r(){}n.r(e),Object.assign(r.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}});var i={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]).toUpperCase()}}(),clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*i.DEG2RAD},radToDeg:function(t){return t*i.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}},s={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function o(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function a(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function u(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}function h(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function c(t,e,n,r,i,s){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new h,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new o,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==s?s:0}function l(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function f(t,e){this.min=void 0!==t?t:new h(1/0,1/0,1/0),this.max=void 0!==e?e:new h(-1/0,-1/0,-1/0)}function d(t,e){this.center=void 0!==t?t:new h,this.radius=void 0!==e?e:0}function m(t,e){this.x=t||0,this.y=e||0}function p(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||p.DefaultOrder}function y(){this.mask=1}Object.assign(o.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(){function t(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}return function(e,n,r){if(e=i.euclideanModulo(e,1),n=i.clamp(n,0,1),r=i.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=t(o,s,e+1/3),this.g=t(o,s,e),this.b=t(o,s,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,u=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(a,u,h)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c,l=(c=n[1]).length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0&&(void 0!==(c=s[t])?this.setHex(c):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(){function t(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),copyLinearToSRGB:function(){function t(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,r=this.r,i=this.g,s=this.b,o=Math.max(r,i,s),a=Math.min(r,i,s),u=(a+o)/2;if(a===o)e=0,n=0;else{var h=o-a;switch(n=u<=.5?h/(o+a):h/(2-o-a),o){case r:e=(i-s)/h+(i<s?6:0);break;case i:e=(s-r)/h+2;break;case s:e=(r-i)/h+4}e/=6}return t.h=e,t.s=n,t.l=u,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var t={};return function(e,n,r){return this.getHSL(t),t.h+=e,t.s+=n,t.l+=r,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Object.assign(a.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,s,o,a,u,h,c,l,f,d,m,p){var y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=i,y[5]=s,y[9]=o,y[13]=a,y[2]=u,y[6]=h,y[10]=c,y[14]=l,y[3]=f,y[7]=d,y[11]=m,y[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new a).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(){var t=new h;return function(e){var n=this.elements,r=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),s=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),u=Math.sin(r),h=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){var l=s*h,f=s*c,d=o*h,m=o*c;e[0]=a*h,e[4]=-a*c,e[8]=u,e[1]=f+d*u,e[5]=l-m*u,e[9]=-o*a,e[2]=m-l*u,e[6]=d+f*u,e[10]=s*a}else if("YXZ"===t.order){var p=a*h,y=a*c,v=u*h,g=u*c;e[0]=p+g*o,e[4]=v*o-y,e[8]=s*u,e[1]=s*c,e[5]=s*h,e[9]=-o,e[2]=y*o-v,e[6]=g+p*o,e[10]=s*a}else if("ZXY"===t.order)p=a*h,y=a*c,v=u*h,g=u*c,e[0]=p-g*o,e[4]=-s*c,e[8]=v+y*o,e[1]=y+v*o,e[5]=s*h,e[9]=g-p*o,e[2]=-s*u,e[6]=o,e[10]=s*a;else if("ZYX"===t.order)l=s*h,f=s*c,d=o*h,m=o*c,e[0]=a*h,e[4]=d*u-f,e[8]=l*u+m,e[1]=a*c,e[5]=m*u+l,e[9]=f*u-d,e[2]=-u,e[6]=o*a,e[10]=s*a;else if("YZX"===t.order){var x=s*a,b=s*u,w=o*a,_=o*u;e[0]=a*h,e[4]=_-x*c,e[8]=w*c+b,e[1]=c,e[5]=s*h,e[9]=-o*h,e[2]=-u*h,e[6]=b*c+w,e[10]=x-_*c}else"XZY"===t.order&&(x=s*a,b=s*u,w=o*a,_=o*u,e[0]=a*h,e[4]=-c,e[8]=u*h,e[1]=x*c+_,e[5]=s*h,e[9]=b*c-w,e[2]=w*c-b,e[6]=o*h,e[10]=_*c+x);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(){var t=new h(0,0,0),e=new h(1,1,1);return function(n){return this.compose(t,n,e)}}(),lookAt:function(){var t=new h,e=new h,n=new h;return function(r,i,s){var o=this.elements;return n.subVectors(r,i),0===n.lengthSq()&&(n.z=1),n.normalize(),t.crossVectors(s,n),0===t.lengthSq()&&(1===Math.abs(s.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),t.crossVectors(s,n)),t.normalize(),e.crossVectors(n,t),o[0]=t.x,o[4]=e.x,o[8]=n.x,o[1]=t.y,o[5]=e.y,o[9]=n.y,o[2]=t.z,o[6]=e.z,o[10]=n.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],u=n[12],h=n[1],c=n[5],l=n[9],f=n[13],d=n[2],m=n[6],p=n[10],y=n[14],v=n[3],g=n[7],x=n[11],b=n[15],w=r[0],_=r[4],M=r[8],z=r[12],k=r[1],A=r[5],S=r[9],E=r[13],T=r[2],N=r[6],O=r[10],j=r[14],C=r[3],B=r[7],U=r[11],I=r[15];return i[0]=s*w+o*k+a*T+u*C,i[4]=s*_+o*A+a*N+u*B,i[8]=s*M+o*S+a*O+u*U,i[12]=s*z+o*E+a*j+u*I,i[1]=h*w+c*k+l*T+f*C,i[5]=h*_+c*A+l*N+f*B,i[9]=h*M+c*S+l*O+f*U,i[13]=h*z+c*E+l*j+f*I,i[2]=d*w+m*k+p*T+y*C,i[6]=d*_+m*A+p*N+y*B,i[10]=d*M+m*S+p*O+y*U,i[14]=d*z+m*E+p*j+y*I,i[3]=v*w+g*k+x*T+b*C,i[7]=v*_+g*A+x*N+b*B,i[11]=v*M+g*S+x*O+b*U,i[15]=v*z+g*E+x*j+b*I,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new h;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix4(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],u=t[13],h=t[2],c=t[6],l=t[10],f=t[14];return t[3]*(+i*a*c-r*u*c-i*o*l+n*u*l+r*o*f-n*a*f)+t[7]*(+e*a*f-e*u*l+i*s*l-r*s*f+r*u*h-i*a*h)+t[11]*(+e*u*c-e*o*f-i*s*c+n*s*f+i*o*h-n*u*h)+t[15]*(-r*o*h-e*a*c+e*o*l+r*s*c-n*s*l+n*a*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],u=r[4],h=r[5],c=r[6],l=r[7],f=r[8],d=r[9],m=r[10],p=r[11],y=r[12],v=r[13],g=r[14],x=r[15],b=d*g*l-v*m*l+v*c*p-h*g*p-d*c*x+h*m*x,w=y*m*l-f*g*l-y*c*p+u*g*p+f*c*x-u*m*x,_=f*v*l-y*d*l+y*h*p-u*v*p-f*h*x+u*d*x,M=y*d*c-f*v*c-y*h*m+u*v*m+f*h*g-u*d*g,z=i*b+s*w+o*_+a*M;if(0===z){var k="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(k);return console.warn(k),this.identity()}var A=1/z;return n[0]=b*A,n[1]=(v*m*a-d*g*a-v*o*p+s*g*p+d*o*x-s*m*x)*A,n[2]=(h*g*a-v*c*a+v*o*l-s*g*l-h*o*x+s*c*x)*A,n[3]=(d*c*a-h*m*a-d*o*l+s*m*l+h*o*p-s*c*p)*A,n[4]=w*A,n[5]=(f*g*a-y*m*a+y*o*p-i*g*p-f*o*x+i*m*x)*A,n[6]=(y*c*a-u*g*a-y*o*l+i*g*l+u*o*x-i*c*x)*A,n[7]=(u*m*a-f*c*a+f*o*l-i*m*l-u*o*p+i*c*p)*A,n[8]=_*A,n[9]=(y*d*a-f*v*a-y*s*p+i*v*p+f*s*x-i*d*x)*A,n[10]=(u*v*a-y*h*a+y*s*l-i*v*l-u*s*x+i*h*x)*A,n[11]=(f*h*a-u*d*a-f*s*l+i*d*l+u*s*p-i*h*p)*A,n[12]=M*A,n[13]=(f*v*o-y*d*o+y*s*m-i*v*m-f*s*g+i*d*g)*A,n[14]=(y*h*o-u*v*o-y*s*c+i*v*c+u*s*g-i*h*g)*A,n[15]=(u*d*o-f*h*o+f*s*c-i*d*c-u*s*m+i*h*m)*A,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,u=i*s,h=i*o;return this.set(u*s+n,u*o-r*a,u*a+r*o,0,u*o+r*a,h*o+n,h*a-r*s,0,u*a-r*o,h*a+r*s,i*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,u=i+i,h=s+s,c=o+o,l=i*u,f=i*h,d=i*c,m=s*h,p=s*c,y=o*c,v=a*u,g=a*h,x=a*c,b=n.x,w=n.y,_=n.z;return r[0]=(1-(m+y))*b,r[1]=(f+x)*b,r[2]=(d-g)*b,r[3]=0,r[4]=(f-x)*w,r[5]=(1-(l+y))*w,r[6]=(p+v)*w,r[7]=0,r[8]=(d+g)*_,r[9]=(p-v)*_,r[10]=(1-(l+m))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(){var t=new h,e=new a;return function(n,r,i){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),u=t.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],e.copy(this);var h=1/o,c=1/a,l=1/u;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=l,e.elements[9]*=l,e.elements[10]*=l,r.setFromRotationMatrix(e),i.x=o,i.y=a,i.z=u,this}}(),makePerspective:function(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*i/(e-t),u=2*i/(n-r),h=(e+t)/(e-t),c=(n+r)/(n-r),l=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,n,r,i,s){var o=this.elements,a=1/(e-t),u=1/(n-r),h=1/(s-i),c=(e+t)*a,l=(n+r)*u,f=(s+i)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}),Object.assign(u,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,s,o){var a=n[r+0],u=n[r+1],h=n[r+2],c=n[r+3],l=i[s+0],f=i[s+1],d=i[s+2],m=i[s+3];if(c!==m||a!==l||u!==f||h!==d){var p=1-o,y=a*l+u*f+h*d+c*m,v=y>=0?1:-1,g=1-y*y;if(g>Number.EPSILON){var x=Math.sqrt(g),b=Math.atan2(x,y*v);p=Math.sin(p*b)/x,o=Math.sin(o*b)/x}var w=o*v;if(a=a*p+l*w,u=u*p+f*w,h=h*p+d*w,c=c*p+m*w,p===1-o){var _=1/Math.sqrt(a*a+u*u+h*h+c*c);a*=_,u*=_,h*=_,c*=_}}t[e]=a,t[e+1]=u,t[e+2]=h,t[e+3]=c}}),Object.defineProperties(u.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(u.prototype,{set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,u=o(n/2),h=o(r/2),c=o(i/2),l=a(n/2),f=a(r/2),d=a(i/2);return"XYZ"===s?(this._x=l*h*c+u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c-l*f*d):"YXZ"===s?(this._x=l*h*c+u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c+l*f*d):"ZXY"===s?(this._x=l*h*c-u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c-l*f*d):"ZYX"===s?(this._x=l*h*c-u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c+l*f*d):"YZX"===s?(this._x=l*h*c+u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c-l*f*d):"XZY"===s&&(this._x=l*h*c-u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c+l*f*d),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],u=n[9],h=n[2],c=n[6],l=n[10],f=r+a+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(c-u)*e,this._y=(s-h)*e,this._z=(o-i)*e):r>a&&r>l?(e=2*Math.sqrt(1+r-a-l),this._w=(c-u)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(s+h)/e):a>l?(e=2*Math.sqrt(1+a-r-l),this._w=(s-h)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+l-r-a),this._w=(o-i)/e,this._x=(s+h)/e,this._y=(u+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new h;return function(n,r){return void 0===e&&(e=new h),(t=n.dot(r)+1)<1e-6?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),angleTo:function(t){return 2*Math.acos(Math.abs(i.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,u=e._z,h=e._w;return this._x=n*h+s*o+r*u-i*a,this._y=r*h+s*a+i*o-n*u,this._z=i*h+s*u+n*a-r*o,this._w=s*h-n*o-r*a-i*u,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var a=1-o*o;if(a<=Number.EPSILON){var u=1-e;return this._w=u*s+e*this._w,this._x=u*n+e*this._x,this._y=u*r+e*this._y,this._z=u*i+e*this._z,this.normalize()}var h=Math.sqrt(a),c=Math.atan2(h,o),l=Math.sin((1-e)*c)/h,f=Math.sin(e*c)/h;return this._w=s*l+this._w*f,this._x=n*l+this._x*f,this._y=r*l+this._y*f,this._z=i*l+this._z*f,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(h.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new u;return function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new u;return function(e,n){return this.applyQuaternion(t.setFromAxisAngle(e,n))}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,u=a*e+s*r-o*n,h=a*n+o*e-i*r,c=a*r+i*n-s*e,l=-i*e-s*n-o*r;return this.x=u*a+l*-i+h*-o-c*-s,this.y=h*a+l*-s+c*-i-u*-o,this.z=c*a+l*-o+u*-s-h*-i,this},project:function(){var t=new a;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new a;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new h,e=new h;return function(n,r){return t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new h;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new h;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(i.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(c.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),Object.assign(l.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,s,o,a,u){var h=this.elements;return h[0]=t,h[1]=r,h[2]=o,h[3]=e,h[4]=i,h[5]=a,h[6]=n,h[7]=s,h[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new h;return function(e){for(var n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix3(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],u=n[1],h=n[4],c=n[7],l=n[2],f=n[5],d=n[8],m=r[0],p=r[3],y=r[6],v=r[1],g=r[4],x=r[7],b=r[2],w=r[5],_=r[8];return i[0]=s*m+o*v+a*b,i[3]=s*p+o*g+a*w,i[6]=s*y+o*x+a*_,i[1]=u*m+h*v+c*b,i[4]=u*p+h*g+c*w,i[7]=u*y+h*x+c*_,i[2]=l*m+f*v+d*b,i[5]=l*p+f*g+d*w,i[8]=l*y+f*x+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8];return e*s*h-e*o*u-n*i*h+n*o*a+r*i*u-r*s*a},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=t.elements,r=this.elements,i=n[0],s=n[1],o=n[2],a=n[3],u=n[4],h=n[5],c=n[6],l=n[7],f=n[8],d=f*u-h*l,m=h*c-f*a,p=l*a-u*c,y=i*d+s*m+o*p;if(0===y){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(v);return console.warn(v),this.identity()}var g=1/y;return r[0]=d*g,r[1]=(o*l-f*s)*g,r[2]=(h*s-o*u)*g,r[3]=m*g,r[4]=(f*i-o*c)*g,r[5]=(o*a-h*i)*g,r[6]=p*g,r[7]=(s*c-l*i)*g,r[8]=(u*i-s*a)*g,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,s,o){var a=Math.cos(i),u=Math.sin(i);this.set(n*a,n*u,-n*(a*s+u*o)+s+t,-r*u,r*a,-r*(-u*s+a*o)+o+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],u=r[4],h=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*u,r[6]=e*o+n*h,r[1]=-n*i+e*a,r[4]=-n*s+e*u,r[7]=-n*o+e*h,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}),Object.assign(f.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0,a=0,u=t.length;a<u;a+=3){var h=t[a],c=t[a+1],l=t[a+2];h<e&&(e=h),c<n&&(n=c),l<r&&(r=l),h>i&&(i=h),c>s&&(s=c),l>o&&(o=l)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0,a=0,u=t.count;a<u;a++){var h=t.getX(a),c=t.getY(a),l=t.getZ(a);h<e&&(e=h),c<n&&(n=c),l<r&&(r=l),h>i&&(i=h),c>s&&(s=c),l>o&&(o=l)}return this.min.set(e,n,r),this.max.set(i,s,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new h;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new h),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new h),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,n,r=new h;function i(i){var s=i.geometry;if(void 0!==s)if(s.isGeometry){var o=s.vertices;for(e=0,n=o.length;e<n;e++)r.copy(o[e]),r.applyMatrix4(i.matrixWorld),t.expandByPoint(r)}else if(s.isBufferGeometry){var a=s.attributes.position;if(void 0!==a)for(e=0,n=a.count;e<n;e++)r.fromBufferAttribute(a,e).applyMatrix4(i.matrixWorld),t.expandByPoint(r)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(i),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new h),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new h;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant},intersectsTriangle:function(){var t=new h,e=new h,n=new h,r=new h,i=new h,s=new h,o=new h,a=new h,u=new h,c=new h;function l(r){var i,s;for(i=0,s=r.length-3;i<=s;i+=3){o.fromArray(r,i);var a=u.x*Math.abs(o.x)+u.y*Math.abs(o.y)+u.z*Math.abs(o.z),h=t.dot(o),c=e.dot(o),l=n.dot(o);if(Math.max(-Math.max(h,c,l),Math.min(h,c,l))>a)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(a),u.subVectors(this.max,a),t.subVectors(o.a,a),e.subVectors(o.b,a),n.subVectors(o.c,a),r.subVectors(e,t),i.subVectors(n,e),s.subVectors(t,n);var h=[0,-r.z,r.y,0,-i.z,i.y,0,-s.z,s.y,r.z,0,-r.x,i.z,0,-i.x,s.z,0,-s.x,-r.y,r.x,0,-i.y,i.x,0,-s.y,s.x,0];return!!l(h)&&!!l(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(r,i),l(h=[c.x,c.y,c.z]))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new h),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new h;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new h;return function(e){return void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new d),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){if(this.isEmpty())return this;var e=t.elements,n=e[0]*this.min.x,r=e[1]*this.min.x,i=e[2]*this.min.x,s=e[0]*this.max.x,o=e[1]*this.max.x,a=e[2]*this.max.x,u=e[4]*this.min.y,h=e[5]*this.min.y,c=e[6]*this.min.y,l=e[4]*this.max.y,f=e[5]*this.max.y,d=e[6]*this.max.y,m=e[8]*this.min.z,p=e[9]*this.min.z,y=e[10]*this.min.z,v=e[8]*this.max.z,g=e[9]*this.max.z,x=e[10]*this.max.z;return this.min.x=Math.min(n,s)+Math.min(u,l)+Math.min(m,v)+e[12],this.min.y=Math.min(r,o)+Math.min(h,f)+Math.min(p,g)+e[13],this.min.z=Math.min(i,a)+Math.min(c,d)+Math.min(y,x)+e[14],this.max.x=Math.max(n,s)+Math.max(u,l)+Math.max(m,v)+e[12],this.max.y=Math.max(r,o)+Math.max(h,f)+Math.max(p,g)+e[13],this.max.z=Math.max(i,a)+Math.max(c,d)+Math.max(y,x)+e[14],this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(d.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new f;return function(e,n){var r=this.center;void 0!==n?r.copy(n):t.setFromPoints(e).getCenter(r);for(var i=0,s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new h),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new f),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.defineProperties(m.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(m.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new m,e=new m;return function(n,r){return t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}}),p.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],p.DefaultOrder="XYZ",Object.defineProperties(p.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(p.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=i.clamp,s=t.elements,o=s[0],a=s[4],u=s[8],h=s[1],c=s[5],l=s[9],f=s[2],d=s[6],m=s[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(u,m),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-f,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===e?(this._y=Math.asin(-r(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(d,m),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===e?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m))):"XZY"===e?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-l,m),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new a;return function(e,n,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,n,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new u;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new h(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(y.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var v=0;function g(){Object.defineProperty(this,"id",{value:v++}),this.uuid=i.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=g.DefaultUp.clone();var t=new h,e=new p,n=new u,r=new h(1,1,1);e.onChange(function(){n.setFromEuler(e,!1)}),n.onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new a},normalMatrix:{value:new l}}),this.matrix=new a,this.matrixWorld=new a,this.matrixAutoUpdate=g.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new y,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}g.DefaultUp=new h(0,1,0),g.DefaultMatrixAutoUpdate=!0,g.prototype=Object.assign(Object.create(r.prototype),{constructor:g,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new u;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new u;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new h(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new h(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new h(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new h;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new h(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new h(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new h(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new a;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new a,e=new h;return function(n,r,i){n.isVector3?e.copy(n):e.set(n,r,i),this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new h),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new h,e=new h;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new u),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,n,e),n}}(),getWorldScale:function(){var t=new h,e=new u;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new h),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new u;return function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new h),this.getWorldQuaternion(t),e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var o=s.shapes;if(Array.isArray(o))for(var a=0,u=o.length;a<u;a++){var h=o[a];i(t.shapes,h)}else i(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(a=0,u=this.material.length;a<u;a++)c.push(i(t.materials,this.material[a]));r.material=c}else r.material=i(t.materials,this.material);if(this.children.length>0)for(r.children=[],a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object);if(e){var l=p(t.geometries),f=p(t.materials),d=p(t.textures),m=p(t.images);o=p(t.shapes),l.length>0&&(n.geometries=l),f.length>0&&(n.materials=f),d.length>0&&(n.textures=d),m.length>0&&(n.images=m),o.length>0&&(n.shapes=o)}return n.object=r,n;function p(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}});var x=0;function b(){Object.defineProperty(this,"id",{value:x+=2}),this.uuid=i.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function w(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}function _(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function M(t,e,n){_.call(this,new Int8Array(t),e,n)}function z(t,e,n){_.call(this,new Uint8Array(t),e,n)}function k(t,e,n){_.call(this,new Uint8ClampedArray(t),e,n)}function A(t,e,n){_.call(this,new Int16Array(t),e,n)}function S(t,e,n){_.call(this,new Uint16Array(t),e,n)}function E(t,e,n){_.call(this,new Int32Array(t),e,n)}function T(t,e,n){_.call(this,new Uint32Array(t),e,n)}function N(t,e,n){_.call(this,new Float32Array(t),e,n)}function O(t,e,n){_.call(this,new Float64Array(t),e,n)}function j(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}b.prototype=Object.assign(Object.create(r.prototype),{constructor:b,isGeometry:!0,applyMatrix:function(t){for(var e=(new l).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(e).normalize();for(var s=0,o=i.vertexNormals.length;s<o;s++)i.vertexNormals[s].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new a;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new a;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new a;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new a;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new a;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new g;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,n=null!==t.index?t.index.array:void 0,r=t.attributes,i=r.position.array,s=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,u=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var f=[],d=[],p=[],y=0,v=0;y<i.length;y+=3,v+=2)e.vertices.push(new h(i[y],i[y+1],i[y+2])),void 0!==s&&f.push(new h(s[y],s[y+1],s[y+2])),void 0!==a&&e.colors.push(new o(a[y],a[y+1],a[y+2])),void 0!==u&&d.push(new m(u[v],u[v+1])),void 0!==l&&p.push(new m(l[v],l[v+1]));function g(t,n,r,i){var o=new c(t,n,r,void 0!==s?[f[t].clone(),f[n].clone(),f[r].clone()]:[],void 0!==a?[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()]:[],i);e.faces.push(o),void 0!==u&&e.faceVertexUvs[0].push([d[t].clone(),d[n].clone(),d[r].clone()]),void 0!==l&&e.faceVertexUvs[1].push([p[t].clone(),p[n].clone(),p[r].clone()])}var x=t.groups;if(x.length>0)for(y=0;y<x.length;y++)for(var b=x[y],w=b.start,_=(v=w,w+b.count);v<_;v+=3)void 0!==n?g(n[v],n[v+1],n[v+2],b.materialIndex):g(v,v+1,v+2,b.materialIndex);else if(void 0!==n)for(y=0;y<n.length;y+=3)g(n[y],n[y+1],n[y+2]);else for(y=0;y<i.length/3;y+=3)g(y,y+1,y+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new h;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new a;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new h,e=new h,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,o),e.subVectors(s,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,n,r,i,s,o;for(void 0===t&&(t=!0),o=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)o[e]=new h;if(t){var a,u,c,l=new h,f=new h;for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],a=this.vertices[s.a],u=this.vertices[s.b],c=this.vertices[s.c],l.subVectors(c,u),f.subVectors(a,u),l.cross(f),o[s.a].add(l),o[s.b].add(l),o[s.c].add(l)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)o[(s=this.faces[r]).a].add(s.normal),o[s.b].add(s.normal),o[s.c].add(s.normal);for(e=0,n=this.vertices.length;e<n;e++)o[e].normalize();for(r=0,i=this.faces.length;r<i;r++){var d=(s=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(o[s.a]),d[1].copy(o[s.b]),d[2].copy(o[s.c])):(d[0]=o[s.a].clone(),d[1]=o[s.b].clone(),d[2]=o[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var r=(n=this.faces[t]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var s=new b;for(s.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)u=new h,c={a:new h,b:new h,c:new h},o.push(u),a.push(c)}var u,c,l=this.morphNormals[t];for(s.vertices=this.morphTargets[t].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],u=l.faceNormals[n],c=l.vertexNormals[n],u.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new f),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new d),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var r,i=this.vertices.length,s=this.vertices,o=t.vertices,a=this.faces,u=t.faces,h=this.faceVertexUvs[0],f=t.faceVertexUvs[0],d=this.colors,m=t.colors;void 0===n&&(n=0),void 0!==e&&(r=(new l).getNormalMatrix(e));for(var p=0,y=o.length;p<y;p++){var v=o[p].clone();void 0!==e&&v.applyMatrix4(e),s.push(v)}for(p=0,y=m.length;p<y;p++)d.push(m[p].clone());for(p=0,y=u.length;p<y;p++){var g,x,b,w=u[p],_=w.vertexNormals,M=w.vertexColors;(g=new c(w.a+i,w.b+i,w.c+i)).normal.copy(w.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var z=0,k=_.length;z<k;z++)x=_[z].clone(),void 0!==r&&x.applyMatrix3(r).normalize(),g.vertexNormals.push(x);for(g.color.copy(w.color),z=0,k=M.length;z<k;z++)b=M[z],g.vertexColors.push(b.clone());g.materialIndex=w.materialIndex+n,a.push(g)}for(p=0,y=f.length;p<y;p++){var A=f[p],S=[];if(void 0!==A){for(z=0,k=A.length;z<k;z++)S.push(A[z].clone());h.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,n,r,i,s,o,a,u={},h=[],c=[],l=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)t=this.vertices[n],void 0===u[e=Math.round(t.x*l)+"_"+Math.round(t.y*l)+"_"+Math.round(t.z*l)]?(u[e]=n,h.push(this.vertices[n]),c[n]=h.length-1):c[n]=c[u[e]];var f=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],s=[i.a,i.b,i.c];for(var d=0;d<3;d++)if(s[d]===s[(d+1)%3]){f.push(n);break}}for(n=f.length-1;n>=0;n--){var m=f[n];for(this.faces.splice(m,1),o=0,a=this.faceVertexUvs.length;o<a;o++)this.faceVertexUvs[o].splice(m,1)}var p=this.vertices.length-h.length;return this.vertices=h,p},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new h(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var r,i,s=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(s&&s.length===e&&(r=[]),o&&o.length===e&&(i=[]),n=0;n<e;n++){var a=t[n]._id;r&&r.push(s[a]),i&&i.push(o[a])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var s=this.vertices[i];r.push(s.x,s.y,s.z)}var o=[],a=[],u={},h=[],c={},l=[],f={};for(i=0;i<this.faces.length;i++){var d=this.faces[i],m=void 0!==this.faceVertexUvs[0][i],p=d.normal.length()>0,y=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,g=d.vertexColors.length>0,x=0;if(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x,0,0),1,!0),2,!1),3,m),4,p),5,y),6,v),7,g),o.push(x),o.push(d.a,d.b,d.c),o.push(d.materialIndex),m){var b=this.faceVertexUvs[0][i];o.push(A(b[0]),A(b[1]),A(b[2]))}if(p&&o.push(z(d.normal)),y){var w=d.vertexNormals;o.push(z(w[0]),z(w[1]),z(w[2]))}if(v&&o.push(k(d.color)),g){var _=d.vertexColors;o.push(k(_[0]),k(_[1]),k(_[2]))}}function M(t,e,n){return n?t|1<<e:t&~(1<<e)}function z(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==u[e]?u[e]:(u[e]=a.length/3,a.push(t.x,t.y,t.z),u[e])}function k(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]?c[e]:(c[e]=h.length,h.push(t.getHex()),c[e])}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==f[e]?f[e]:(f[e]=l.length/2,l.push(t.x,t.y),f[e])}return t.data={},t.data.vertices=r,t.data.normals=a,h.length>0&&(t.data.colors=h),l.length>0&&(t.data.uvs=[l]),t.data.faces=o,t},clone:function(){return(new b).copy(this)},copy:function(t){var e,n,r,i,s,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,n=a.length;e<n;e++)this.vertices.push(a[e].clone());var u=t.colors;for(e=0,n=u.length;e<n;e++)this.colors.push(u[e].clone());var h=t.faces;for(e=0,n=h.length;e<n;e++)this.faces.push(h[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),r=0,i=c.length;r<i;r++){var l=c[r],f=[];for(s=0,o=l.length;s<o;s++){var d=l[s];f.push(d.clone())}this.faceVertexUvs[e].push(f)}}var m=t.morphTargets;for(e=0,n=m.length;e<n;e++){var p={};if(p.name=m[e].name,void 0!==m[e].vertices)for(p.vertices=[],r=0,i=m[e].vertices.length;r<i;r++)p.vertices.push(m[e].vertices[r].clone());if(void 0!==m[e].normals)for(p.normals=[],r=0,i=m[e].normals.length;r<i;r++)p.normals.push(m[e].normals[r].clone());this.morphTargets.push(p)}var y=t.morphNormals;for(e=0,n=y.length;e<n;e++){var v={};if(void 0!==y[e].vertexNormals)for(v.vertexNormals=[],r=0,i=y[e].vertexNormals.length;r<i;r++){var g=y[e].vertexNormals[r],x={};x.a=g.a.clone(),x.b=g.b.clone(),x.c=g.c.clone(),v.vertexNormals.push(x)}if(void 0!==y[e].faceNormals)for(v.faceNormals=[],r=0,i=y[e].faceNormals.length;r<i;r++)v.faceNormals.push(y[e].faceNormals[r].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,n=b.length;e<n;e++)this.skinWeights.push(b[e].clone());var w=t.skinIndices;for(e=0,n=w.length;e<n;e++)this.skinIndices.push(w[e].clone());var _=t.lineDistances;for(e=0,n=_.length;e<n;e++)this.lineDistances.push(_[e]);var M=t.boundingBox;null!==M&&(this.boundingBox=M.clone());var z=t.boundingSphere;return null!==z&&(this.boundingSphere=z.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(w.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,s=t.elements,o=s[0],a=s[4],u=s[8],h=s[1],c=s[5],l=s[9],f=s[2],d=s[6],m=s[10];if(Math.abs(a-h)<.01&&Math.abs(u-f)<.01&&Math.abs(l-d)<.01){if(Math.abs(a+h)<.1&&Math.abs(u+f)<.1&&Math.abs(l+d)<.1&&Math.abs(o+c+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var p=(o+1)/2,y=(c+1)/2,v=(m+1)/2,g=(a+h)/4,x=(u+f)/4,b=(l+d)/4;return p>y&&p>v?p<.01?(n=0,r=.707106781,i=.707106781):(r=g/(n=Math.sqrt(p)),i=x/n):y>v?y<.01?(n=.707106781,r=0,i=.707106781):(n=g/(r=Math.sqrt(y)),i=b/r):v<.01?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(v)),r=b/i),this.set(n,r,i,e),this}var w=Math.sqrt((d-l)*(d-l)+(u-f)*(u-f)+(h-a)*(h-a));return Math.abs(w)<.001&&(w=1),this.x=(d-l)/w,this.y=(u-f)/w,this.z=(h-a)/w,this.w=Math.acos((o+c+m-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new w,e=new w),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.defineProperty(_.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(_.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.itemSize:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new o),e[n++]=s.r,e[n++]=s.g,e[n++]=s.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new m),e[n++]=s.x,e[n++]=s.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new h),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var s=t[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new w),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z,e[n++]=s.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),M.prototype=Object.create(_.prototype),M.prototype.constructor=M,z.prototype=Object.create(_.prototype),z.prototype.constructor=z,k.prototype=Object.create(_.prototype),k.prototype.constructor=k,A.prototype=Object.create(_.prototype),A.prototype.constructor=A,S.prototype=Object.create(_.prototype),S.prototype.constructor=S,E.prototype=Object.create(_.prototype),E.prototype.constructor=E,T.prototype=Object.create(_.prototype),T.prototype.constructor=T,N.prototype=Object.create(_.prototype),N.prototype.constructor=N,O.prototype=Object.create(_.prototype),O.prototype.constructor=O,Object.assign(j.prototype,{computeGroups:function(t){for(var e,n=[],r=void 0,i=t.faces,s=0;s<i.length;s++){var o=i[s];o.materialIndex!==r&&(r=o.materialIndex,void 0!==e&&(e.count=3*s-e.start,n.push(e)),e={start:3*s,materialIndex:r})}void 0!==e&&(e.count=3*s-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,n=t.faces,r=t.vertices,i=t.faceVertexUvs,s=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,a=t.morphTargets,u=a.length;if(u>0){e=[];for(var h=0;h<u;h++)e[h]=[];this.morphTargets.position=e}var c,l=t.morphNormals,f=l.length;if(f>0){for(c=[],h=0;h<f;h++)c[h]=[];this.morphTargets.normal=c}var d=t.skinIndices,p=t.skinWeights,y=d.length===r.length,v=p.length===r.length;for(r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),h=0;h<n.length;h++){var g=n[h];this.vertices.push(r[g.a],r[g.b],r[g.c]);var x=g.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var b=g.normal;this.normals.push(b,b,b)}var w,_=g.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var M=g.color;this.colors.push(M,M,M)}!0===s&&(void 0!==(w=i[0][h])?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new m,new m,new m))),!0===o&&(void 0!==(w=i[1][h])?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new m,new m,new m)));for(var z=0;z<u;z++){var k=a[z].vertices;e[z].push(k[g.a],k[g.b],k[g.c])}for(z=0;z<f;z++){var A=l[z].vertexNormals[h];c[z].push(A.a,A.b,A.c)}y&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var C=1;function B(){Object.defineProperty(this,"id",{value:C+=2}),this.uuid=i.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function U(t,e,n,r){b.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new I(t,e,n,r)),this.mergeVertices()}function I(t,e,n,r){B.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};var i,s,o=(t=t||1)/2,a=(e=e||1)/2,u=Math.floor(n)||1,h=Math.floor(r)||1,c=u+1,l=h+1,f=t/u,d=e/h,m=[],p=[],y=[],v=[];for(s=0;s<l;s++){var g=s*d-a;for(i=0;i<c;i++){var x=i*f-o;p.push(x,-g,0),y.push(0,0,1),v.push(i/u),v.push(1-s/h)}}for(s=0;s<h;s++)for(i=0;i<u;i++){var b=i+c*s,w=i+c*(s+1),_=i+1+c*(s+1),M=i+1+c*s;m.push(b,w,M),m.push(w,_,M)}this.setIndex(m),this.addAttribute("position",new N(p,3)),this.addAttribute("normal",new N(y,3)),this.addAttribute("uv",new N(v,2))}B.prototype=Object.assign(Object.create(r.prototype),{constructor:B,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(function(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}(t)>65535?T:S)(t,1):this.index=t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new _(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var n=this.attributes.normal;return void 0!==n&&((new l).getNormalMatrix(t).applyToBufferAttribute(n),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new a;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new a;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new a;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new a;return function(e,n,r){return t.makeTranslation(e,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new a;return function(e,n,r){return t.makeScale(e,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new g;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new h;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new N(3*e.vertices.length,3),r=new N(3*e.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new N(e.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new N(e,3)),this},updateFromObject:function(t){var e,n=t.geometry;if(t.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(n.vertices),e.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(n.normals),e.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(n.colors),e.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(n.uvs),e.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(n.lineDistances),e.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new j).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new _(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new _(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.addAttribute("color",new _(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new _(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var s=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new _(s,2).copyVector2sArray(t.uvs2))}for(var o in this.groups=t.groups,t.morphTargets){for(var a=[],u=t.morphTargets[o],h=0,c=u.length;h<c;h++){var l=u[h],f=new N(3*l.length,3);a.push(f.copyVector3sArray(l))}this.morphAttributes[o]=a}if(t.skinIndices.length>0){var d=new N(4*t.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var m=new N(4*t.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new f);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new f,e=new h;return function(){null===this.boundingSphere&&(this.boundingSphere=new d);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;t.setFromBufferAttribute(n),t.getCenter(r);for(var i=0,s=0,o=n.count;s<o;s++)e.x=n.getX(s),e.y=n.getY(s),e.z=n.getZ(s),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,n=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new _(new Float32Array(r.length),3));else for(var i=e.normal.array,s=0,o=i.length;s<o;s++)i[s]=0;var a,u,c,l=e.normal.array,f=new h,d=new h,m=new h,p=new h,y=new h;if(t){var v=t.array;0===n.length&&this.addGroup(0,v.length);for(var g=0,x=n.length;g<x;++g){var b=n[g],w=b.start;for(s=w,o=w+b.count;s<o;s+=3)a=3*v[s+0],u=3*v[s+1],c=3*v[s+2],f.fromArray(r,a),d.fromArray(r,u),m.fromArray(r,c),p.subVectors(m,d),y.subVectors(f,d),p.cross(y),l[a]+=p.x,l[a+1]+=p.y,l[a+2]+=p.z,l[u]+=p.x,l[u+1]+=p.y,l[u+2]+=p.z,l[c]+=p.x,l[c+1]+=p.y,l[c+2]+=p.z}}else for(s=0,o=r.length;s<o;s+=9)f.fromArray(r,s),d.fromArray(r,s+3),m.fromArray(r,s+6),p.subVectors(m,d),y.subVectors(f,d),p.cross(y),l[s]=p.x,l[s+1]=p.y,l[s+2]=p.z,l[s+3]=p.x,l[s+4]=p.y,l[s+5]=p.z,l[s+6]=p.x,l[s+7]=p.y,l[s+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,s=t.attributes[r],o=s.array,a=0,u=s.itemSize*e;a<o.length;a++,u++)i[u]=o[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new h;return function(){for(var e=this.attributes.normal,n=0,r=e.count;n<r;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.normalize(),e.setXYZ(n,t.x,t.y,t.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new B,e=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],s=i.array,o=i.itemSize,a=new s.constructor(e.length*o),u=0,h=0,c=0,l=e.length;c<l;c++){u=e[c]*o;for(var f=0;f<o;f++)a[h++]=s[u++]}t.addAttribute(r,new _(a,o))}var d=this.groups;for(c=0,l=d.length;c<l;c++){var m=d[c];t.addGroup(m.start,m.count,m.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);t.data.index={type:r.array.constructor.name,array:i}}var s=this.attributes;for(var n in s){var o=s[n];i=Array.prototype.slice.call(o.array),t.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:i,normalized:o.normalized}}var a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));var u=this.boundingSphere;return null!==u&&(t.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),t},clone:function(){return(new B).copy(this)},copy:function(t){var e,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var s=t.attributes;for(e in s){var o=s[e];this.addAttribute(e,o.clone())}var a=t.morphAttributes;for(e in a){var u=[],h=a[e];for(n=0,r=h.length;n<r;n++)u.push(h[n].clone());this.morphAttributes[e]=u}var c=t.groups;for(n=0,r=c.length;n<r;n++){var l=c[n];this.addGroup(l.start,l.count,l.materialIndex)}var f=t.boundingBox;null!==f&&(this.boundingBox=f.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),U.prototype=Object.create(b.prototype),U.prototype.constructor=U,I.prototype=Object.create(B.prototype),I.prototype.constructor=I;var P=n(4);function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var V=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.version=n,this.db=new P.a("mapcache"),this.db.version(this.version).stores(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},"chunks-".concat(e),"[x+z],modified")),this.chunks=this.db["chunks-".concat(e)]}return function(t,e,n){e&&D(t.prototype,e)}(t,[{key:"saveChunk",value:function(t,e,n){return this.chunks.put({x:t,z:e,chunkData:n,modified:Date.now()})}},{key:"loadChunk",value:function(t,e){return this.chunks.where({x:t,z:e}).toArray().then(function(t){if(t.length){var e=t[0];if(e&&e.chunkData)return e.chunkData}return null})}},{key:"clear",value:function(){return this.chunks.clear()}}]),t}(),F=n(5),R=n.n(F),q=n(6),H=n.n(q),G=n(7),W=n.n(G)()(1,0,.85,.85),K=function(t){return t.reduce(function(t,e){return t+e},0)/t.length},L=[{d:.3,c:3367874},{d:.35,c:3630791},{d:.4,c:13685120},{d:.55,c:5740312},{d:.6,c:4155925},{d:.7,c:6112318},{d:.9,c:5061434},{d:100,c:16776959}],X=function(t){for(var e=0;e<L.length;e++){var n=L[e],r=n.d,i=n.c;if(t<=r)return i}return 0},Y=new V("world1"),Z=new U(256,256,127,127);Z.rotateX(-Math.PI/2);var Q=function(t,e){var n=function(t,e){return function(t){var e=t.seed,n=t.scale,r=void 0===n?100:n,i=t.octaves,s=void 0===i?8:i,o=t.persistance,a=void 0===o?.5:o,u=t.lacunarity,h=void 0===u?2:u,c=t.offset,l=void 0===c?{x:0,y:0}:c;r<=0&&(r=1e-4);for(var f=new Float32Array(16384),d=new R.a(e),m=new H.a(e),p=0,y=1,v=[],g=0;g<s;g++){var x=2e5*d.quick()-1e5+l.x,b=2e5*d.quick()-1e5-l.y;v.push({x:x,y:b}),p+=y,y*=a}for(var w=0;w<128;w++)for(var _=0;_<128;_++){y=1;for(var M=1,z=0,k=0;k<s;k++){var A=(_-64+v[k].x)/r*M,S=(w-64+v[k].y)/r*M;z+=m.noise2D(A,S)*y,y*=a,M*=h}f[128*_+w]=Math.max(0,(z+1)/(1.16*p))}return f}({seed:"a-19sdfu428",offset:{x:127*e,y:127*-t}})}(t,e),r=function(t){for(var e=new Uint32Array(32258),n=0;n<127;n++)for(var r=0;r<127;r++){var i=t[128*n+r],s=t[128*n+r+1],o=t[128*(n+1)+r],a=t[128*(n+1)+r+1],u=2*n*127+2*r;e[u]=e[u+1]=X(K([s,a,o,i]))}return e}(n);n=function(t){for(var e=0;e<t.length;e++)t[e]=60*W(t[e]);return t}(n);for(var i=Z.clone(),s=0;s<n.length;s++)i.vertices[s].y=n[s];for(var o=0;o<r.length;o++)i.faces[o].color.setHex(r[o]);return i.computeVertexNormals(),(new B).fromGeometry(i).attributes};self.onmessage=function(t){var e=t.data;switch(e.cmd){case"loadChunk":!function(t){var e=t.x,n=t.z;Y.loadChunk(e,n).then(function(t){return t||(t=Q(e,n),Y.saveChunk(e,n,t).then(function(){return t}))}).then(function(t){var r=t.position,i=t.color,s=t.uv,o=t.normal;self.postMessage({cmd:"terrain",x:e,z:n,attributes:t},[r.array.buffer,i.array.buffer,s.array.buffer,o.array.buffer])}).catch(console.error)}(e);break;case"clearCache":Y.clear()}}}]);